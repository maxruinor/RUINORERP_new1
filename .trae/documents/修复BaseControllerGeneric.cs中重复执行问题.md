# 修复BaseControllerGeneric.cs中重复执行问题

## 问题分析

经过代码分析，我发现`BaseQuerySimpleByAdvancedNavWithConditionsAsync`方法在以下情况下会短时间内执行两次：

1. **重试机制导致**：当捕获到DataReader关闭异常（包含"FieldCount"或"阅读器关闭"的错误信息）时，方法会执行重试逻辑：
   - 第一次执行：第950-951行的原始查询
   - 第二次执行：第972行的重试查询

2. **执行流程**：
   - 正常情况下，方法只执行一次第950-951行的查询
   - 当遇到DataReader关闭异常时，会等待100ms后重新创建查询并执行第972行的查询

## 解决方案

### 方案1：优化重试机制，避免重复执行相同逻辑

1. **添加重试计数**：使用计数器记录重试次数，避免无限重试
2. **增强日志**：在重试前后添加详细日志，便于排查问题
3. **改进异常处理**：区分不同类型的DataReader异常，采取不同的处理策略
4. **连接池优化**：检查并优化数据库连接池配置，减少DataReader关闭异常的发生

### 方案2：重构方法结构，分离核心逻辑

1. **提取查询构建逻辑**：将查询构建逻辑提取到单独的方法中
2. **统一执行入口**：使用单一入口执行查询，避免重复代码
3. **智能重试**：只在必要时进行重试，避免不必要的重复执行

## 具体修改步骤

1. **修改BaseControllerGeneric.cs文件**：
   - 在方法中添加重试计数变量
   - 优化try-catch块的异常处理逻辑
   - 添加详细的日志记录
   - 重构查询构建和执行逻辑

2. **验证修复效果**：
   - 测试正常情况下的执行流程
   - 模拟DataReader关闭异常，测试重试机制
   - 确认修复后不会出现短时间内重复执行的问题

## 预期效果

- 正常情况下，方法只执行一次查询
- 当遇到DataReader关闭异常时，执行重试逻辑，但通过日志清晰记录
- 避免因重试机制导致的重复执行问题
- 提高方法的稳定性和可维护性