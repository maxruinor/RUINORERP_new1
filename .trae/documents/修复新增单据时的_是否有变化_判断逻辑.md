## 问题分析

当前在BaseBillEditGeneric.cs的2005-2034行中，"是否有变化"的判断逻辑存在缺陷：

```csharp
hasUnsavedChanges = pkid > 0 || Edited;
```

这个逻辑会导致以下问题：

* 当打开现有单据（pkid > 0）时，无论是否修改，都会被判断为有变化

* 当处于编辑状态（Edited为true）时，无论是否实际修改了数据，都会被判断为有变化

* 无法正确处理"全新打开未编辑的单据"场景

## 解决方案

利用BaseEntity已实现的完整变化跟踪机制，替换当前的判断逻辑。BaseEntity类提供了以下用于判断变化的属性和方法：

* `HasChanged` 属性：标记实体是否有变化

* `GetEffectiveChanges()` 方法：获取实际发生变化的属性及其原始值和当前值

* `ChangedProperties` 属性：获取所有已变更属性的名称集合

## 修复计划

1. **修改BaseBillEditGeneric.cs中的判断逻辑**：

   * 将当前基于pkid和Edited的判断逻辑替换为基于BaseEntity.HasChanged属性的判断

   * 确保只有当实体实际发生数据变更时，才判断为"有未保存的更改"

2. **修复后的代码示例**：

   ```csharp
   // 检查是否有未保存的数据更改
   bool hasUnsavedChanges = false;

   // 检查主实体是否有更改
   if (EditEntity != null)
   {
       // 使用BaseEntity内置的HasChanged属性判断是否有实际变化
       hasUnsavedChanges = EditEntity.HasChanged;
   }
   ```

3. **验证测试场景**：

   * 打开全新单据不做任何修改直接点击新增，应无提示

   * 打开现有单据不做任何修改直接点击新增，应无提示

   * 对单据进行修改后点击新增，应显示确认提示

   * 对单据进行修改后又撤销所有修改，点击新增应无提示

## 预期效果

修复后，系统将能够准确判断当前单据是否已被修改或发生变化，只有在确实发生数据变更时才触发新增提示，提升用户体验。
