# 修复自动更新程序的文件处理优先级

## 问题分析

当前自动更新程序在处理文件时，按照文件在列表中的顺序依次处理：
- 如果是zip文件，解压到目标目录（覆盖现有文件）
- 如果是普通文件，直接复制（覆盖现有文件）

这种方式没有明确的优先级，导致无法保证哪种类型的文件会最终生效。

## 解决方案

根据企业级系统的最佳实践，我们应该：
1. 先处理所有zip文件，解压到目标目录
2. 然后处理所有普通文件，覆盖zip中可能已存在的同名文件

这样可以确保单个文件（可能是更精确的更新）优先于zip中的批量更新。

## 实施步骤

1. **修改CopyFile方法**（e:\CodeRepository\SynologyDrive\RUINORERP\AutoUpdate\FrmUpdate.cs）：
   - 将文件列表分为普通文件和zip文件两组
   - 先处理所有zip文件，解压到目标目录
   - 然后处理所有普通文件，直接复制
   - 保持原有的错误处理和日志记录

2. **保持现有功能不变**：
   - 继续支持zip文件解压
   - 继续支持普通文件复制
   - 继续支持覆盖现有文件
   - 继续记录详细日志

3. **验证修改**：
   - 确保修改后的代码编译通过
   - 确保修改不影响其他功能
   - 确保zip文件和普通文件都能正确处理
   - 确保普通文件能覆盖zip中的同名文件

## 预期效果

- 明确了文件处理优先级：普通文件 > zip文件
- 确保单个文件的精确更新能生效
- 保持了原有功能的完整性
- 提高了自动更新的可靠性和可预测性

## 代码修改点

```csharp
// 在CopyFile方法中，修改文件处理逻辑
// 原代码：
for (int i = 0; i < files.Length; i++)
{
    // 处理每个文件，无论类型
}

// 修改为：
// 1. 先处理所有zip文件
var zipFiles = files.Where(f => Path.GetExtension(f).ToLower() == ".zip").ToArray();
var regularFiles = files.Where(f => Path.GetExtension(f).ToLower() != ".zip").ToArray();

// 2. 处理zip文件
foreach (var file in zipFiles)
{
    // 解压zip文件
}

// 3. 处理普通文件
foreach (var file in regularFiles)
{
    // 复制普通文件
}
```