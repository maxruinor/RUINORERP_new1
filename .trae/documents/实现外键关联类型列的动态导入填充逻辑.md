# 实现外键关联类型列的动态导入填充逻辑

## 问题分析
当前系统在处理外键关联类型列的动态导入时，每次都会查询数据库获取外键值，对于大量数据导入时效率较低。需要实现预加载缓存机制，在导入开始前批量查询所有关联表数据，缓存后用于后续匹配，提高性能。

## 解决方案

### 1. 修改 ForeignKeyService.cs
- **添加缓存字典**：添加私有字典 `_foreignKeyCache` 用于缓存外键数据，键为表名+字段名组合，值为字段值到主键ID的映射
- **添加预加载方法**：新增 `PreloadForeignKeyData` 方法，根据导入配置中的外键映射，批量查询关联表数据并缓存
- **优化查询方法**：修改 `GetForeignKeyId` 方法，优先使用缓存数据，支持精确匹配和模糊匹配，缓存未命中时再查询数据库

### 2. 修改 DynamicImporter.cs
- **调用预加载**：在 `ImportAsync` 方法开始时，调用 `ForeignKeyService.PreloadForeignKeyData` 方法预加载所有外键数据

### 3. 实现细节
- **缓存键设计**：使用 `$"{relatedTableName}_{relatedTableField}"` 作为缓存键，确保唯一性
- **数据加载**：查询关联表的 `SELECT {fieldName}, ID FROM {tableName}` 语句，获取所有数据
- **匹配算法**：支持精确匹配（优先）和模糊匹配（当精确匹配失败时）
- **错误处理**：添加异常捕获，确保预加载失败不影响导入流程
- **日志记录**：使用 `Debug.WriteLine` 记录预加载和查询过程中的异常信息

## 技术优势
- **性能提升**：预加载机制避免了逐行查询数据库，大幅提高导入速度
- **可靠性增强**：缓存机制减少了数据库连接次数，降低了网络依赖
- **可维护性**：代码结构清晰，逻辑分离，易于理解和扩展
- **兼容性**：保持原有接口不变，无缝集成到现有系统

## 测试方案
1. 创建包含外键关联的导入配置
2. 导入包含大量行的Excel文件，验证导入速度
3. 验证外键值正确填充到目标表
4. 测试外键值不存在时的错误处理
5. 测试模糊匹配功能

此实现符合项目现有架构规范，通过预加载缓存机制显著提高外键关联导入的性能，同时保持系统稳定性和可靠性。