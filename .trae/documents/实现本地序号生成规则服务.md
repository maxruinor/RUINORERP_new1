# 务实现本地序号生成规则服

## 1. 需求分析

在`InitModuleMenu.cs`文件中实现本地序号生成规则服务，用于系统初始化时生成模块编号，避免依赖网络服务。

## 2. 实现方案

采用方案二：重写一个新方法专门实现本地序号生成功能，保持原方法稳定性的同时提供专门的本地生成功能。

## 3. 详细实现步骤

### 3.1 在`ClientBizCodeService`类中添加本地序号生成方法

1. 添加异步方法`GenerateLocalBaseInfoNoAsync`，用于本地生成基础信息编号
2. 添加静态方法`GetLocalBaseInfoNo`，兼容旧的调用模式
3. 实现本地序号生成逻辑，使用BNR架构体系中的组件

### 3.2 实现本地序号生成逻辑

1. 使用BNRFactory或LightweightBNRFactory创建序号生成器
2. 实现本地数据库序列服务的本地版本
3. 支持基于日期、常量等参数的序号生成

### 3.3 修改`InitModuleMenu.cs`中的调用

将`ClientBizCodeService.GetBaseInfoNo(BaseInfoType.ModuleDefinition)`替换为`ClientBizCodeService.GetLocalBaseInfoNo(BaseInfoType.ModuleDefinition)`

## 4. 代码实现细节

### 4.1 在`ClientBizCodeService.cs`中添加的方法

```csharp
/// <summary>
/// 本地生成基础信息编号
/// </summary>
/// <param name="baseInfoType">基础信息类型枚举</param>
/// <param name="paraConst">参数常量（可选）</param>
/// <param name="ct">取消令牌</param>
/// <returns>生成的基础信息编号</returns>
public async Task<string> GenerateLocalBaseInfoNoAsync(BaseInfoType baseInfoType, string paraConst = null, CancellationToken ct = default)
{
    // 本地序号生成逻辑实现
}

/// <summary>
/// 获取本地基础信息编号（静态方法，兼容旧的调用模式）
/// </summary>
/// <param name="baseInfoType">基础信息类型枚举</param>
/// <param name="paraConst">参数常量（可选）</param>
/// <returns>生成的基础信息编号</returns>
public static string GetLocalBaseInfoNo(BaseInfoType baseInfoType, string paraConst = null)
{
    // 静态方法实现
}
```

### 4.2 修改`InitModuleMenu.cs`中的调用

```csharp
// 修改前
ModuleNo = ClientBizCodeService.GetBaseInfoNo(BaseInfoType.ModuleDefinition),

// 修改后
ModuleNo = ClientBizCodeService.GetLocalBaseInfoNo(BaseInfoType.ModuleDefinition),
```

## 5. 技术要点

1. **BNR架构体系兼容**：确保使用BNR目录下的组件和接口
2. **性能优化**：本地生成避免网络延迟，提高系统初始化速度
3. **可靠性**：实现本地数据库序列，确保序号唯一性
4. **兼容性**：保持与现有代码的兼容性，不破坏原有功能
5. **可扩展性**：支持多种序号生成规则，便于未来扩展

## 6. 预期效果

* 系统初始化时不再依赖网络服务生成模块编号

* 提高系统初始化速度

* 增强系统在离线环境下的可用性

* 保持与BNR架构体系的一致性

* 兼容现有代码调用方式

## 7. 后续优化方向

* 支持更多类型的本地序号生成规则

* 添加缓存机制，提高序号生成性能

* 实现序号生成规则的配置化管理

