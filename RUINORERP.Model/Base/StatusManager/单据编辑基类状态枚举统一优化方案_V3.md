# å•æ®ç¼–è¾‘åŸºç±»çŠ¶æ€æšä¸¾ç»Ÿä¸€ä¼˜åŒ–æ–¹æ¡ˆ V3.0

## æ–‡æ¡£ä¿¡æ¯
- **åˆ›å»ºæ—¥æœŸ**: 2026-01-25
- **ç‰ˆæœ¬**: V3.0 - æ¸©å’Œæ¸è¿›å¼ä¼˜åŒ–
- **ä½œè€…**: AI Assistant
- **ç›®æ ‡**: ç»Ÿä¸€ä½¿ç”¨StateManagerç®¡ç†æ‰€æœ‰çŠ¶æ€åˆ¤æ–­å’Œè®¾ç½®

---

## è®¾è®¡åŸåˆ™

### æ ¸å¿ƒç†å¿µ
**æ‰€æœ‰çŠ¶æ€åˆ¤æ–­å’Œè®¾ç½®éƒ½åº”è¯¥é€šè¿‡ç»Ÿä¸€çš„çŠ¶æ€ç®¡ç†ä½“ç³»å®Œæˆ,è€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨æšä¸¾å€¼**

### ä¼˜åŒ–åŸåˆ™
1. **ä¸ç ´åç°æœ‰åŠŸèƒ½** - ä¿æŒå‘åå…¼å®¹
2. **æ¸è¿›å¼ä¼˜åŒ–** - åˆ†é˜¶æ®µé€æ­¥æ›¿æ¢
3. **ç»Ÿä¸€ç®¡ç†** - æ‰€æœ‰çŠ¶æ€æ“ä½œé€šè¿‡StateManager
4. **æå‡å¯ç»´æŠ¤æ€§** - ä»£ç æ›´æ¸…æ™°,é€»è¾‘æ›´ç»Ÿä¸€

---

## ä¼˜åŒ–èŒƒå›´

### æ–‡ä»¶åˆ—è¡¨
1. `BaseBillEditGeneric.cs` - å•æ®ç¼–è¾‘åŸºç±»
2. `BaseBillQueryMC.cs` - å•æ®æŸ¥è¯¢åŸºç±»

---

## ä¼˜åŒ–åˆ†ç±»

### 1. å®¡æ ¸çŠ¶æ€ç›¸å…³ (14å¤„)

#### 1.1 åå®¡æƒé™æ£€æŸ¥ (3å¤„)

**ä½ç½®**: 
- `BaseBillQueryMC.cs` Line 1219, 1384
- `BaseBillEditGeneric.cs` Line 4326

**åŸä»£ç **:
```csharp
if (EditEntity.GetPropertyValue("ApprovalStatus").ToInt() == (int)ApprovalStatus.å®¡æ ¸é€šè¿‡
    && EditEntity.GetPropertyValue("ApprovalResults") != null
    && EditEntity.GetPropertyValue("ApprovalResults").ToBool() == true)
```

**ä¼˜åŒ–æ–¹æ¡ˆ**:
```csharp
// ä½¿ç”¨StateManageræ£€æŸ¥åå®¡æƒé™
var (canExecute, message) = StateManager.CanExecuteActionWithMessage(entity, MenuItemEnums.åå®¡);
if (!canExecute)
{
    KryptonMessageBox.Show(message, "æ— æ³•åå®¡", MessageBoxButtons.OK, MessageBoxIcon.Warning);
    return;
}
```

**ä¼˜å…ˆçº§**: ğŸ”´ é«˜

---

#### 1.2 ç»“æ¡ˆçŠ¶æ€æ£€æŸ¥ (1å¤„)

**ä½ç½®**: `BaseBillEditGeneric.cs` Line 3800

**åŸä»£ç **:
```csharp
if (EditEntity.GetPropertyValue("DataStatus").ToInt() == (int)DataStatus.ç¡®è®¤
    && EditEntity.GetPropertyValue("ApprovalStatus").ToInt() == (int)ApprovalStatus.å®¡æ ¸é€šè¿‡
    && EditEntity.GetPropertyValue("ApprovalResults") != null
    && EditEntity.GetPropertyValue("ApprovalResults").ToBool() == true)
```

**ä¼˜åŒ–æ–¹æ¡ˆ**:
```csharp
// ä½¿ç”¨StateManageræ£€æŸ¥ç»“æ¡ˆæƒé™
var (canExecute, message) = StateManager.CanExecuteActionWithMessage(entity, MenuItemEnums.ç»“æ¡ˆ);
if (!canExecute)
{
    KryptonMessageBox.Show(message, "æ— æ³•ç»“æ¡ˆ", MessageBoxButtons.OK, MessageBoxIcon.Warning);
    return;
}
```

**ä¼˜å…ˆçº§**: ğŸ”´ é«˜

---

#### 1.3 å®¡æ ¸çŠ¶æ€è®¾ç½® (5å¤„)

**ä½ç½®**:
- `BaseBillQueryMC.cs` Line 1271, 1283 (ä½¿ç”¨StateManager,ä½†æœªä½¿ç”¨ç»Ÿä¸€æ–¹æ³•)
- `BaseBillEditGeneric.cs` Line 1295, 3985, 4020
- `BaseBillEditGeneric.cs` Line 5863, 6662 (ä½¿ç”¨StateManager.SetBusinessStatusAsync)

**åŸä»£ç  (éƒ¨åˆ†)**:
```csharp
// å®¡æ ¸é©³å›
EditEntity.SetPropertyValue("ApprovalStatus", (int)ApprovalStatus.å®¡æ ¸é©³å›);

// å®¡æ ¸é€šè¿‡
EditEntity.SetPropertyValue("ApprovalStatus", (int)ApprovalStatus.å®¡æ ¸é€šè¿‡);

// éƒ¨åˆ†å·²ä½¿ç”¨StateManager
await StateManager.SetBusinessStatusAsync<DataStatus>(baseEntity, DataStatus.ç¡®è®¤);
```

**ä¼˜åŒ–æ–¹æ¡ˆ**:
```csharp
// ç»Ÿä¸€ä½¿ç”¨SetStatusByActionAsync
// å®¡æ ¸é©³å›
var result = await StateManager.SetStatusByActionAsync(entity, MenuItemEnums.å®¡æ ¸é©³å›, reason: ae.ApprovalOpinions);
if (!result.IsSuccess)
{
    KryptonMessageBox.Show(result.ErrorMessage, "å®¡æ ¸å¤±è´¥", MessageBoxButtons.OK, MessageBoxIcon.Error);
    return;
}

// å®¡æ ¸é€šè¿‡
var result = await StateManager.SetStatusByActionAsync(entity, MenuItemEnums.å®¡æ ¸, reason: ae.ApprovalOpinions);
if (!result.IsSuccess)
{
    KryptonMessageBox.Show(result.ErrorMessage, "å®¡æ ¸å¤±è´¥", MessageBoxButtons.OK, MessageBoxIcon.Error);
    return;
}
```

**ä¼˜å…ˆçº§**: ğŸ”´ é«˜

---

#### 1.4 å®¡æ ¸çŠ¶æ€åˆå§‹åŒ– (5å¤„)

**ä½ç½®**:
- `BaseBillEditGeneric.cs` Line 4116 (é”€å”®é€€å›å•è‡ªåŠ¨å®¡æ ¸)
- `BaseBillEditGeneric.cs` Line 5539 (åˆå§‹åŒ–ä¸ºè‰ç¨¿)
- `BaseBillEditGeneric.cs` Line 6667 (è®¾ç½®æœªå®¡æ ¸)

**åŸä»£ç **:
```csharp
// è®¾ç½®æœªå®¡æ ¸
ReflectionHelper.SetPropertyValue(entity, typeof(ApprovalStatus).Name, (int)ApprovalStatus.æœªå®¡æ ¸);

// è‡ªåŠ¨å®¡æ ¸
payable.ApprovalStatus = (int)ApprovalStatus.å®¡æ ¸é€šè¿‡;
```

**ä¼˜åŒ–æ–¹æ¡ˆ**:
```csharp
// è®¾ç½®åˆå§‹å®¡æ ¸çŠ¶æ€
var result = await StateManager.SetBusinessStatusAsync(entity, ApprovalStatus.æœªå®¡æ ¸, reason: "æ–°å»ºå•æ®");
if (!result.IsSuccess)
{
    logger.LogError($"è®¾ç½®åˆå§‹å®¡æ ¸çŠ¶æ€å¤±è´¥: {result.ErrorMessage}");
}
```

**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­

---

### 2. æ•°æ®çŠ¶æ€ç›¸å…³ (13å¤„)

#### 2.1 æ‰“å°çŠ¶æ€æ£€æŸ¥ (2å¤„)

**ä½ç½®**:
- `BaseBillQueryMC.cs` Line 746
- `BaseBillEditGeneric.cs` Line 7596, 7602

**åŸä»£ç **:
```csharp
if (item.GetPropertyValue("DataStatus").ToString() == ((int)DataStatus.è‰ç¨¿).ToString() 
    || item.GetPropertyValue("DataStatus").ToString() == ((int)DataStatus.æ–°å»º).ToString())
{
    if (MessageBox.Show($"å½“å‰ã€{bizType.ToString()}ã€‘æ²¡æœ‰å®¡æ ¸,ä½ ç¡®å®šè¦æ‰“å°å—ï¼Ÿ", "æç¤º", MessageBoxButtons.YesNo, MessageBoxIcon.Warning, MessageBoxDefaultButton.Button2) == DialogResult.No)
    {
        return;
    }
}
```

**ä¼˜åŒ–æ–¹æ¡ˆ**:
```csharp
// ä½¿ç”¨StateManageræ£€æŸ¥æ˜¯å¦å¯ä»¥æ‰“å°
var (canExecute, message) = StateManager.CanExecuteActionWithMessage(entity, MenuItemEnums.æ‰“å°);
if (!canExecute)
{
    // æ˜¾ç¤ºæç¤ºä¿¡æ¯
    if (KryptonMessageBox.Show(message, "æç¤º", MessageBoxButtons.YesNo, MessageBoxIcon.Warning) == DialogResult.No)
    {
        return;
    }
}
```

**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­

---

#### 2.2 ä¿å­˜æ—¶çŠ¶æ€è½¬æ¢ (2å¤„)

**ä½ç½®**:
- `BaseBillEditGeneric.cs` Line 5859 (æ–°å»ºâ†’è‰ç¨¿)
- `BaseBillEditGeneric.cs` Line 6662 (è®¾ç½®ä¸ºæ–°å»º)

**åŸä»£ç **:
```csharp
var dataStatus = (DataStatus)(editEntity.GetPropertyValue(typeof(DataStatus).Name).ToInt());
if (dataStatus == DataStatus.æ–°å»º)
{
    await StateManager.SetBusinessStatusAsync<DataStatus>(editEntity, DataStatus.è‰ç¨¿, "ä¿å­˜æ—¶å°†æ–°å»ºçŠ¶æ€é‡ç½®ä¸ºè‰ç¨¿");
}
```

**ä¼˜åŒ–æ–¹æ¡ˆ**:
```csharp
// è¿™éƒ¨åˆ†å·²ç»ä½¿ç”¨äº†StateManager,ä¿æŒä¸å˜
// åªéœ€è¦ç¡®ä¿é”™è¯¯å¤„ç†å®Œå–„
var dataStatus = (DataStatus)(editEntity.GetPropertyValue(typeof(DataStatus).Name).ToInt());
if (dataStatus == DataStatus.æ–°å»º)
{
    var result = await StateManager.SetBusinessStatusAsync<DataStatus>(editEntity, DataStatus.è‰ç¨¿, "ä¿å­˜æ—¶å°†æ–°å»ºçŠ¶æ€é‡ç½®ä¸ºè‰ç¨¿");
    if (!result.IsSuccess)
    {
        logger.LogError($"ä¿å­˜æ—¶é‡ç½®çŠ¶æ€å¤±è´¥: {result.ErrorMessage}");
        KryptonMessageBox.Show("ä¿å­˜çŠ¶æ€æ›´æ–°å¤±è´¥", "è­¦å‘Š", MessageBoxButtons.OK, MessageBoxIcon.Warning);
    }
}
```

**ä¼˜å…ˆçº§**: ğŸŸ¢ ä½ (å·²ä½¿ç”¨StateManager,åªéœ€å®Œå–„é”™è¯¯å¤„ç†)

---

#### 2.3 åˆ é™¤æƒé™æ£€æŸ¥ (1å¤„)

**ä½ç½®**: `BaseBillEditGeneric.cs` Line 6399

**åŸä»£ç **:
```csharp
var dataStatus = (DataStatus)(editEntity.GetPropertyValue(typeof(DataStatus).Name).ToInt());
if (dataStatus == DataStatus.æ–°å»º || dataStatus == DataStatus.è‰ç¨¿)
{
    // å¦‚æœæ˜¯æ–°å»º,åˆ™æäº¤è¿‡äº†ã€‚è¦åˆ›å»ºäººæˆ–è¶…çº§ç®¡ç†å‘˜æ‰èƒ½åˆ é™¤
    if (dataStatus == DataStatus.æ–°å»º && !AppContext.IsSuperUser)
    {
        if (ReflectionHelper.ExistPropertyName<T>("Created_by") 
            && ReflectionHelper.GetPropertyValue(editEntity, "Created_by").ToString() != AppContext.CurUserInfo.EmpID.ToString())
        {
            KryptonMessageBox.Show("ä½ æ— æƒåˆ é™¤è¯¥å•æ®ï¼", "æç¤º", MessageBoxButtons.OK, MessageBoxIcon.Warning);
            return;
        }
    }
}
```

**ä¼˜åŒ–æ–¹æ¡ˆ**:
```csharp
// ä½¿ç”¨StateManageræ£€æŸ¥åˆ é™¤æƒé™
var (canExecute, message) = StateManager.CanExecuteActionWithMessage(entity, MenuItemEnums.åˆ é™¤);
if (!canExecute)
{
    KryptonMessageBox.Show(message, "æ— æ³•åˆ é™¤", MessageBoxButtons.OK, MessageBoxIcon.Warning);
    return;
}
```

**ä¼˜å…ˆçº§**: ğŸ”´ é«˜

---

#### 2.4 ä¿®æ”¹æƒé™æ£€æŸ¥ (1å¤„)

**ä½ç½®**: `BaseBillEditGeneric.cs` Line 6499

**åŸä»£ç **:
```csharp
var dataStatus = (DataStatus)(editEntity.GetPropertyValue(typeof(DataStatus).Name).ToInt());
if (dataStatus == DataStatus.å®Œç»“ || dataStatus == DataStatus.ç¡®è®¤)
{
    // ç¦æ­¢ä¿®æ”¹é€»è¾‘...
}
```

**ä¼˜åŒ–æ–¹æ¡ˆ**:
```csharp
// ä½¿ç”¨StateManageræ£€æŸ¥ä¿®æ”¹æƒé™
var (canModify, message) = StateManager.CanModifyWithMessage(entity);
if (!canModify)
{
    KryptonMessageBox.Show(message, "æ— æ³•ä¿®æ”¹", MessageBoxButtons.OK, MessageBoxIcon.Warning);
    return;
}
```

**ä¼˜å…ˆçº§**: ğŸ”´ é«˜

---

#### 2.5 è‡ªåŠ¨å®¡æ ¸é€»è¾‘ (2å¤„)

**ä½ç½®**:
- `BaseBillEditGeneric.cs` Line 6561-6565 (é”€å”®è®¢å•)
- `BaseBillEditGeneric.cs` Line 6606-6608 (é‡‡è´­è®¢å•)

**åŸä»£ç **:
```csharp
saleOrder.ApprovalResults = true;
saleOrder.ApprovalStatus = (int)ApprovalStatus.å®¡æ ¸é€šè¿‡;
saleOrder.ApprovalOpinions = "è‡ªåŠ¨å®¡æ ¸";
saleOrder.DataStatus = (int)DataStatus.ç¡®è®¤;
```

**ä¼˜åŒ–æ–¹æ¡ˆ**:
```csharp
// ä½¿ç”¨StateManagerè®¾ç½®çŠ¶æ€
var approvalResult = await StateManager.SetStatusByActionAsync(saleOrder, MenuItemEnums.å®¡æ ¸, reason: "è‡ªåŠ¨å®¡æ ¸");
if (!approvalResult.IsSuccess)
{
    logger.LogError($"è‡ªåŠ¨å®¡æ ¸å¤±è´¥: {approvalResult.ErrorMessage}");
    return;
}
```

**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­

---

#### 2.6 å…¶ä»–çŠ¶æ€è®¾ç½® (3å¤„)

**ä½ç½®**:
- `BaseBillEditGeneric.cs` Line 2824 (æ£€æŸ¥å®Œç»“/ç¡®è®¤çŠ¶æ€)
- `BaseBillQueryMC.cs` Line 1275, 1287 (å®¡æ ¸åè®¾ç½®çŠ¶æ€)

**ä¼˜å…ˆçº§**: ğŸŸ¢ ä½

---

## è¾…åŠ©æ–¹æ³•è®¾è®¡

ä¸ºäº†ç®€åŒ–ä»£ç ,åœ¨`BaseBillEditGeneric`ä¸­æ·»åŠ ä»¥ä¸‹è¾…åŠ©æ–¹æ³•:

```csharp
#region çŠ¶æ€ç®¡ç†è¾…åŠ©æ–¹æ³•

/// <summary>
/// æ£€æŸ¥æ˜¯å¦å¯ä»¥æ‰§è¡ŒæŒ‡å®šæ“ä½œ
/// </summary>
/// <param name="action">æ“ä½œç±»å‹</param>
/// <returns>æ˜¯å¦å¯ä»¥æ‰§è¡ŒåŠæ¶ˆæ¯</returns>
protected (bool CanExecute, string Message) CanPerformAction(MenuItemEnums action)
{
    if (EditEntity == null || StateManager == null)
    {
        return (false, "å®ä½“æˆ–çŠ¶æ€ç®¡ç†å™¨æœªåˆå§‹åŒ–");
    }

    return StateManager.CanExecuteActionWithMessage(EditEntity, action);
}

/// <summary>
/// æ£€æŸ¥æ˜¯å¦å¯ä»¥æ‰§è¡ŒæŒ‡å®šæ“ä½œå¹¶æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
/// </summary>
/// <param name="action">æ“ä½œç±»å‹</param>
/// <param name="operationName">æ“ä½œåç§°(ç”¨äºæç¤º)</param>
/// <returns>æ˜¯å¦å¯ä»¥æ‰§è¡Œ</returns>
protected bool CheckActionPermission(MenuItemEnums action, string operationName)
{
    var (canExecute, message) = CanPerformAction(action);
    if (!canExecute)
    {
        KryptonMessageBox.Show(message, operationName, MessageBoxButtons.OK, MessageBoxIcon.Warning);
        return false;
    }
    return true;
}

/// <summary>
/// æ‰§è¡ŒçŠ¶æ€è½¬æ¢æ“ä½œ
/// </summary>
/// <param name="action">æ“ä½œç±»å‹</param>
/// <param name="reason">å˜æ›´åŸå› </param>
/// <returns>æ˜¯å¦æˆåŠŸ</returns>
protected async Task<bool> ExecuteStatusTransition(MenuItemEnums action, string reason = null)
{
    if (EditEntity == null || StateManager == null)
    {
        KryptonMessageBox.Show("å®ä½“æˆ–çŠ¶æ€ç®¡ç†å™¨æœªåˆå§‹åŒ–", "é”™è¯¯", MessageBoxButtons.OK, MessageBoxIcon.Error);
        return false;
    }

    var result = await StateManager.SetStatusByActionAsync(EditEntity, action, reason: reason);
    if (!result.IsSuccess)
    {
        KryptonMessageBox.Show(result.ErrorMessage, "çŠ¶æ€è½¬æ¢å¤±è´¥", MessageBoxButtons.OK, MessageBoxIcon.Error);
        return false;
    }

    // æ›´æ–°UIçŠ¶æ€
    UpdateAllUIStates(EditEntity);
    
    return true;
}

/// <summary>
/// æ£€æŸ¥æ˜¯å¦å¯ä»¥ä¿®æ”¹å®ä½“
/// </summary>
/// <returns>æ˜¯å¦å¯ä»¥ä¿®æ”¹åŠæ¶ˆæ¯</returns>
protected (bool CanModify, string Message) CanModifyEntity()
{
    if (EditEntity == null || StateManager == null)
    {
        return (false, "å®ä½“æˆ–çŠ¶æ€ç®¡ç†å™¨æœªåˆå§‹åŒ–");
    }

    return StateManager.CanModifyWithMessage(EditEntity);
}

/// <summary>
/// æ£€æŸ¥æ˜¯å¦å¯ä»¥ä¿®æ”¹å¹¶æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
/// </summary>
/// <returns>æ˜¯å¦å¯ä»¥ä¿®æ”¹</returns>
protected bool CheckModifyPermission()
{
    var (canModify, message) = CanModifyEntity();
    if (!canModify)
    {
        KryptonMessageBox.Show(message, "æ— æ³•ä¿®æ”¹", MessageBoxButtons.OK, MessageBoxIcon.Warning);
        return false;
    }
    return true;
}

/// <summary>
/// è®¾ç½®å®ä½“ä¸ºåˆå§‹çŠ¶æ€
/// </summary>
/// <typeparam name="TStatus">çŠ¶æ€ç±»å‹</typeparam>
/// <param name="status">åˆå§‹çŠ¶æ€</param>
/// <param name="reason">åŸå› </param>
/// <returns>æ˜¯å¦æˆåŠŸ</returns>
protected async Task<bool> SetEntityInitialStatus<TStatus>(TStatus status, string reason = null) 
    where TStatus : struct, Enum
{
    if (EditEntity == null || StateManager == null)
    {
        return false;
    }

    var result = await StateManager.SetBusinessStatusAsync(EditEntity, status, reason: reason);
    if (!result.IsSuccess)
    {
        logger?.LogError($"è®¾ç½®åˆå§‹çŠ¶æ€å¤±è´¥: {result.ErrorMessage}");
        return false;
    }

    return true;
}

#endregion
```

---

## å®æ–½æ­¥éª¤

### é˜¶æ®µ1: æ·»åŠ è¾…åŠ©æ–¹æ³• (1å°æ—¶)
- [ ] åœ¨`BaseBillEditGeneric.cs`ä¸­æ·»åŠ çŠ¶æ€ç®¡ç†è¾…åŠ©æ–¹æ³•åŒºåŸŸ
- [ ] ç¼–è¯‘æ£€æŸ¥
- [ ] æµ‹è¯•è¾…åŠ©æ–¹æ³•

### é˜¶æ®µ2: æ›¿æ¢å®¡æ ¸çŠ¶æ€åˆ¤æ–­ (2å°æ—¶)
- [ ] æ›¿æ¢åå®¡æƒé™æ£€æŸ¥ (3å¤„)
- [ ] æ›¿æ¢ç»“æ¡ˆçŠ¶æ€æ£€æŸ¥ (1å¤„)
- [ ] æ›¿æ¢å®¡æ ¸çŠ¶æ€è®¾ç½® (5å¤„)
- [ ] æ›¿æ¢å®¡æ ¸çŠ¶æ€åˆå§‹åŒ– (5å¤„)
- [ ] ç¼–è¯‘æ£€æŸ¥
- [ ] åŠŸèƒ½æµ‹è¯•

### é˜¶æ®µ3: æ›¿æ¢æ•°æ®çŠ¶æ€åˆ¤æ–­ (2å°æ—¶)
- [ ] æ›¿æ¢æ‰“å°çŠ¶æ€æ£€æŸ¥ (2å¤„)
- [ ] å®Œå–„ä¿å­˜æ—¶çŠ¶æ€è½¬æ¢ (2å¤„)
- [ ] æ›¿æ¢åˆ é™¤æƒé™æ£€æŸ¥ (1å¤„)
- [ ] æ›¿æ¢ä¿®æ”¹æƒé™æ£€æŸ¥ (1å¤„)
- [ ] æ›¿æ¢è‡ªåŠ¨å®¡æ ¸é€»è¾‘ (2å¤„)
- [ ] ç¼–è¯‘æ£€æŸ¥
- [ ] åŠŸèƒ½æµ‹è¯•

### é˜¶æ®µ4: å…¨é¢æµ‹è¯• (1å°æ—¶)
- [ ] å®¡æ ¸æµç¨‹æµ‹è¯•
- [ ] åå®¡æµç¨‹æµ‹è¯•
- [ ] ç»“æ¡ˆæµç¨‹æµ‹è¯•
- [ ] åˆ é™¤æµç¨‹æµ‹è¯•
- [ ] ä¿®æ”¹æµç¨‹æµ‹è¯•
- [ ] æ‰“å°æµç¨‹æµ‹è¯•
- [ ] UIçŠ¶æ€æ›´æ–°æµ‹è¯•

### é˜¶æ®µ5: æ–‡æ¡£æ•´ç† (30åˆ†é’Ÿ)
- [ ] æ›´æ–°ä¼˜åŒ–æ€»ç»“æ–‡æ¡£
- [ ] è®°å½•ä¼˜åŒ–æ•ˆæœ
- [ ] æ€»ç»“ç»éªŒæ•™è®­

---

## ä¼˜åŒ–æ•ˆæœé¢„æœŸ

### ä»£ç è´¨é‡æå‡
- âœ… **ä¸€è‡´æ€§**: æ‰€æœ‰çŠ¶æ€æ“ä½œç»Ÿä¸€é€šè¿‡StateManager
- âœ… **å¯è¯»æ€§**: ä»£ç æ›´ç®€æ´æ˜“æ‡‚
- âœ… **å¯ç»´æŠ¤æ€§**: çŠ¶æ€é€»è¾‘é›†ä¸­ç®¡ç†
- âœ… **å¯æ‰©å±•æ€§**: æ–°å¢çŠ¶æ€è§„åˆ™æ— éœ€ä¿®æ”¹ä¸šåŠ¡ä»£ç 

### æ¶æ„ä¼˜åŠ¿
- âœ… **æ¾è€¦åˆ**: ä¸šåŠ¡é€»è¾‘ä¸çŠ¶æ€ç®¡ç†å®Œå…¨åˆ†ç¦»
- âœ… **è§„åˆ™åŒ–**: çŠ¶æ€è½¬æ¢è§„åˆ™ç»Ÿä¸€é…ç½®
- âœ… **å¯æµ‹è¯•æ€§**: çŠ¶æ€é€»è¾‘å¯ç‹¬ç«‹æµ‹è¯•
- âœ… **å¯å®¡è®¡æ€§**: æ‰€æœ‰çŠ¶æ€å˜æ›´éƒ½æœ‰æ—¥å¿—

---

## é£é™©æ§åˆ¶

### å›æ»šæ–¹æ¡ˆ
1. ä¿ç•™æ‰€æœ‰ä¿®æ”¹æ–‡ä»¶çš„å¤‡ä»½
2. æ¯ä¸ªé˜¶æ®µå®Œæˆåè¿›è¡Œç¼–è¯‘å’Œæµ‹è¯•
3. å¦‚é‡é—®é¢˜å¯å¿«é€Ÿå›æ»šåˆ°ä¸Šä¸€ä¸ªç¨³å®šç‰ˆæœ¬

### å…¼å®¹æ€§ä¿è¯
1. ç¡®ä¿StateManagerå·²æ­£ç¡®åˆå§‹åŒ–
2. ä¿æŒæ–¹æ³•ç­¾åä¸å˜
3. ç¡®ä¿UIæ›´æ–°æœºåˆ¶æ­£å¸¸

### æµ‹è¯•è¦ç‚¹
1. å®¡æ ¸æµç¨‹å®Œæ•´æ€§
2. åå®¡æµç¨‹åˆæ³•æ€§
3. çŠ¶æ€è½¬æ¢æ­£ç¡®æ€§
4. UIçŠ¶æ€åŒæ­¥
5. å¼‚å¸¸å¤„ç†

---

## æ³¨æ„äº‹é¡¹

1. **å¼‚æ­¥å¤„ç†**: çŠ¶æ€è®¾ç½®æ“ä½œéƒ½æ˜¯å¼‚æ­¥çš„,éœ€è¦ä½¿ç”¨await
2. **é”™è¯¯å¤„ç†**: æ‰€æœ‰çŠ¶æ€æ“ä½œéƒ½éœ€è¦å®Œå–„çš„é”™è¯¯å¤„ç†
3. **UIåŒæ­¥**: çŠ¶æ€å˜æ›´åéœ€è¦è°ƒç”¨`UpdateAllUIStates`æ›´æ–°UI
4. **æ—¥å¿—è®°å½•**: é‡è¦çŠ¶æ€å˜æ›´éœ€è¦è®°å½•æ—¥å¿—
5. **ç”¨æˆ·æç¤º**: çŠ¶æ€è½¬æ¢å¤±è´¥æ—¶éœ€è¦ç»™ç”¨æˆ·æ¸…æ™°çš„æç¤º

---

## é™„å½•

### å®Œæ•´ä¿®æ”¹æ¸…å•

| åºå· | æ–‡ä»¶ | è¡Œå· | ç±»å‹ | ä¼˜å…ˆçº§ | çŠ¶æ€ |
|------|------|------|------|--------|------|
| 1 | BaseBillQueryMC.cs | 1219 | åå®¡æ£€æŸ¥ | ğŸ”´ é«˜ | å¾…å¤„ç† |
| 2 | BaseBillQueryMC.cs | 1384 | åå®¡æ£€æŸ¥ | ğŸ”´ é«˜ | å¾…å¤„ç† |
| 3 | BaseBillQueryMC.cs | 1271 | çŠ¶æ€è®¾ç½® | ğŸŸ¡ ä¸­ | å·²ä½¿ç”¨StateManager |
| 4 | BaseBillQueryMC.cs | 1283 | çŠ¶æ€è®¾ç½® | ğŸŸ¡ ä¸­ | å·²ä½¿ç”¨StateManager |
| 5 | BaseBillQueryMC.cs | 746 | æ‰“å°æ£€æŸ¥ | ğŸŸ¡ ä¸­ | å¾…å¤„ç† |
| 6 | BaseBillEditGeneric.cs | 4326 | åå®¡æ£€æŸ¥ | ğŸ”´ é«˜ | å¾…å¤„ç† |
| 7 | BaseBillEditGeneric.cs | 3800 | ç»“æ¡ˆæ£€æŸ¥ | ğŸ”´ é«˜ | å¾…å¤„ç† |
| 8 | BaseBillEditGeneric.cs | 1295 | å®¡æ ¸é©³å› | ğŸ”´ é«˜ | å¾…å¤„ç† |
| 9 | BaseBillEditGeneric.cs | 3985 | å®¡æ ¸é©³å› | ğŸ”´ é«˜ | å¾…å¤„ç† |
| 10 | BaseBillEditGeneric.cs | 4020 | å®¡æ ¸é€šè¿‡ | ğŸ”´ é«˜ | å¾…å¤„ç† |
| 11 | BaseBillEditGeneric.cs | 5859 | çŠ¶æ€è½¬æ¢ | ğŸŸ¢ ä½ | å·²ä½¿ç”¨StateManager |
| 12 | BaseBillEditGeneric.cs | 6662 | çŠ¶æ€è½¬æ¢ | ğŸŸ¢ ä½ | å·²ä½¿ç”¨StateManager |
| 13 | BaseBillEditGeneric.cs | 6399 | åˆ é™¤æ£€æŸ¥ | ğŸ”´ é«˜ | å¾…å¤„ç† |
| 14 | BaseBillEditGeneric.cs | 6499 | ä¿®æ”¹æ£€æŸ¥ | ğŸ”´ é«˜ | å¾…å¤„ç† |
| 15 | BaseBillEditGeneric.cs | 6561 | è‡ªåŠ¨å®¡æ ¸ | ğŸŸ¡ ä¸­ | å¾…å¤„ç† |
| 16 | BaseBillEditGeneric.cs | 6606 | è‡ªåŠ¨å®¡æ ¸ | ğŸŸ¡ ä¸­ | å¾…å¤„ç† |
| 17 | BaseBillEditGeneric.cs | 4116 | å®¡æ ¸åˆå§‹åŒ– | ğŸŸ¡ ä¸­ | å¾…å¤„ç† |
| 18 | BaseBillEditGeneric.cs | 5539 | å®¡æ ¸åˆå§‹åŒ– | ğŸŸ¡ ä¸­ | å¾…å¤„ç† |
| 19 | BaseBillEditGeneric.cs | 6667 | å®¡æ ¸åˆå§‹åŒ– | ğŸŸ¡ ä¸­ | å¾…å¤„ç† |
| 20 | BaseBillEditGeneric.cs | 7596 | æ‰“å°æ£€æŸ¥ | ğŸŸ¡ ä¸­ | å¾…å¤„ç† |
| 21 | BaseBillEditGeneric.cs | 7602 | æ‰“å°æ£€æŸ¥ | ğŸŸ¡ ä¸­ | å¾…å¤„ç† |

---

## æ€»ç»“

æœ¬æ–¹æ¡ˆé‡‡ç”¨æ¸©å’Œæ¸è¿›çš„æ–¹å¼,å°†æ‰€æœ‰ç›´æ¥ä½¿ç”¨çŠ¶æ€æšä¸¾çš„ä»£ç æ›¿æ¢ä¸ºç»Ÿä¸€çš„çŠ¶æ€ç®¡ç†ä½“ç³»ã€‚é€šè¿‡æ·»åŠ è¾…åŠ©æ–¹æ³•ç®€åŒ–ä»£ç è°ƒç”¨,æé«˜ä»£ç è´¨é‡å’Œå¯ç»´æŠ¤æ€§ã€‚

**å…³é”®ä¼˜åŠ¿**:
1. ç»Ÿä¸€çš„çŠ¶æ€ç®¡ç†,é¿å…åˆ†æ•£çš„æšä¸¾åˆ¤æ–­
2. ç®€åŒ–çš„APIè°ƒç”¨,é™ä½ä»£ç å¤æ‚åº¦
3. å®Œå–„çš„é”™è¯¯å¤„ç†å’Œç”¨æˆ·æç¤º
4. æ›´å¥½çš„å¯æµ‹è¯•æ€§å’Œå¯ç»´æŠ¤æ€§

**é¢„è®¡å·¥ä½œé‡**: 6.5å°æ—¶
**é¢„è®¡æ”¶ç›Š**: ä»£ç è´¨é‡æå‡,å¯ç»´æŠ¤æ€§å¤§å¹…æ”¹å–„
