# 对账单功能使用说明书

## 一、功能概述

对账单功能是系统中用于管理企业与客户/供应商往来账款对账的核心模块，支持用户将应收/应付账款数据转换为对账单，便于财务人员进行往来账款管理、核销和结算。

本功能主要解决企业在多客户/多供应商复杂往来场景下的对账需求，特别优化了余额对账模式，支持不同业务类型（销售/采购）的金额自动抵扣冲销，提供直观的数据展示和汇总计算。

## 二、对账类型说明

系统提供三种对账模式，用户可根据业务需求选择合适的对账类型：

### 1. 余额对账（默认模式）

- **功能特点**：同时显示所有往来单位（包括客户和供应商）的应收/应付记录
- **金额处理规则**：收款类型数据显示为正数，付款类型数据显示为负数
- **对账单生成逻辑**：根据选中数据的总余额正负值自动决定生成收款对账单还是付款对账单
- **适用场景**：需要综合考虑客户/供应商的应收应付余额，实现往来账款对冲

### 2. 收款对账

- **功能特点**：仅显示客户相关的收款类型数据
- **查询范围限制**：仅显示客户类型往来单位，且收付款类型为"收款"
- **适用场景**：专注于应收账款管理，向客户催收货款

### 3. 付款对账

- **功能特点**：仅显示供应商相关的付款类型数据
- **查询范围限制**：仅显示供应商类型往来单位，且收付款类型为"付款"
- **适用场景**：专注于应付账款管理，向供应商支付货款

## 三、业务逻辑说明

### 1. 金额正负值处理规则

在余额对账模式下，系统采用以下业务规则处理金额：

- **收款类型记录**：所有金额字段（总金额、余额、已核销金额等）显示为正数
- **付款类型记录**：所有金额字段（总金额、余额、已核销金额等）显示为负数
- **汇总计算**：根据收付款类型自动调整金额符号进行汇总，确保余额计算正确
- **对账单生成**：
  - 当选中记录总余额≥0时，生成收款对账单
  - 当选中记录总余额<0时，生成付款对账单

### 2. 数据展示优化

为确保用户直观理解对账数据，系统在余额对账模式下对数据显示进行了以下优化：

- **单元格格式化**：根据收付款类型动态调整金额列的显示格式
- **汇总列计算**：自定义汇总逻辑，确保汇总结果符合业务预期
- **数据正负值一致性**：确保在整个流程中（从查询显示到对账单生成）数据正负值保持一致

## 四、使用步骤

### 1. 进入对账中心

1. 从系统主菜单导航至「财务管理」→「对账管理」→「对账中心」
2. 系统默认进入余额对账模式

### 2. 选择对账类型

在查询面板上方的对账类型下拉框中选择所需的对账模式：
- 余额对账（默认）
- 收款对账
- 付款对账

选择后，系统会自动刷新查询条件和数据显示。

### 3. 设置查询条件

根据业务需求，设置相应的查询条件：
- 客户/供应商筛选
- 日期范围
- 单据状态
- 其他必要的查询条件

### 4. 执行查询

点击查询按钮，系统将根据所选对账类型和查询条件显示符合条件的应收/应付记录。

### 5. 选择数据生成对账单

1. 在查询结果中选择需要生成对账单的记录（可多选）
2. 右键点击选中的数据行，选择「【生成对账单】」菜单项
3. 系统会进行以下校验：
   - 确保所有选中记录币别相同
   - 验证记录状态是否允许转换为对账单
   - 如选择多个客户/供应商，会提示确认是否合并
4. 校验通过后，系统自动根据余额对账逻辑生成对账单并打开

## 五、注意事项

### 1. 数据选择限制

- **币别一致性**：生成对账单时，所选记录必须为同一币别
- **状态要求**：只有状态为「待支付」或「部分支付」的记录才能生成对账单
- **客户/供应商合并**：多选不同客户/供应商时需谨慎确认，系统会提示是否合并生成对账单

### 2. 余额对账特殊说明

- 在余额对账模式下，付款类型的数据会以负数形式显示，这是为了便于余额计算和理解
- 生成对账单时，系统会根据所有选中记录的总余额正负值自动决定生成收款对账单还是付款对账单
- 汇总金额会自动考虑收付款类型的金额符号，确保计算结果准确

### 3. 对账单后续操作

- 生成的对账单可进行审核、确认、核销等后续操作
- 对账单与原始应收/应付记录之间保持关联关系
- 对账单的核销会相应更新原始应收/应付记录的状态和余额

## 六、常见问题解答

### 1. 问：为什么在余额对账模式下，有些金额显示为负数？

**答**：这是系统的正常设计。在余额对账模式下，付款类型的记录金额会以负数形式显示，这样可以直观地反映往来账款的实际情况，便于余额的汇总计算和理解。

### 2. 问：如何判断生成的是收款对账单还是付款对账单？

**答**：在余额对账模式下，系统会根据您选择的所有记录的总余额自动判断：
- 总余额≥0时，生成收款对账单
- 总余额<0时，生成付款对账单

在收款对账或付款对账模式下，系统会根据您选择的对账类型直接生成对应的对账单。

### 3. 问：是否可以将多个不同客户/供应商的记录合并生成一个对账单？

**答**：系统支持合并生成，但会提示您确认。请注意，合并不同客户/供应商的记录可能会导致财务处理复杂化，建议谨慎操作。

### 4. 问：为什么某些记录无法生成对账单？

**答**：可能的原因包括：
- 记录状态不允许（必须是「待支付」或「部分支付」状态）
- 记录已被标记为不允许添加到对账单
- 记录余额为零

系统会在生成对账单时显示详细的提示信息，请根据提示调整选择。

## 七、最佳实践

1. **日常对账**：建议使用余额对账模式，可以全面了解与各往来单位的总体对账情况
2. **特定业务**：对于专门的收款或付款业务，可以选择对应的收款对账或付款对账模式
3. **数据准确性**：生成对账单前，建议仔细核对所选记录的金额和状态
4. **定期核对**：建议定期使用此功能与客户/供应商进行账款核对，确保往来账款准确无误

---

本文档由系统管理员提供，如有疑问请联系技术支持。