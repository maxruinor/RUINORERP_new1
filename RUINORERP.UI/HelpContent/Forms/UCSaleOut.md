# 销售出库单窗体

## 窗体概述

销售出库单窗体用于根据销售订单生成出库单，完成产品出库发货操作。该窗体支持全部出库、部分出库、替代品出库等多种出库方式。

## 窗体布局

### 主信息区
- **来源订单**：销售订单、订单编号
- **出库信息**：出库单号、出库日期、仓库
- **客户信息**：客户、客户PO号、平台订单号
- **交期信息**：交货日期、运输方式、送货地址
- **财务信息**：币别、汇率、付款状态、退货状态
- **特殊选项**：定制订单、平台单、替代品出库、生成凭证
- **物流信息**：物流单号、运费成本
- **审批信息**：审批结果、审批意见

### 明细区（表格）
- 产品明细列表
- 出库数量、单价、金额
- 成本信息
- 税额、佣金

### 汇总区
- 总数量、总成本、总金额
- 税额、佣金金额
- 运费收入

## 基本操作流程

### 新建出库单（从订单）

1. 点击工具栏"新建"按钮或按 `Ctrl+N`
2. 选择销售订单（`txtSaleOrder`）
3. 系统自动带出订单明细
4. 确认出库数量（默认为订单剩余数量）
5. 保存出库单（`Ctrl+S`）

### 新建出库单（直接出库）

1. 点击工具栏"新建"按钮
2. 选择客户
3. 直接添加产品明细
4. 输入出库数量
5. 保存出库单

### 审核出库单

1. 打开出库单
2. 检查出库信息是否正确
3. 点击"审核"按钮
4. 审核后系统自动扣减库存

### 取消审核

1. 打开已审核的出库单
2. 点击"取消审核"按钮
3. 系统恢复库存

### 删除出库单

1. 查询要删除的出库单
2. 点击"删除"按钮
3. 确认删除操作
4. 删除后无法恢复

## 重要业务场景

### 场景1：全部出库

**业务场景**：订单数量一次全部出库

**操作步骤**：
1. 选择销售订单
2. 系统自动填入订单剩余数量
3. 确认出库数量等于订单数量
4. 保存并审核出库单
5. 订单状态变为"已出库"

**系统处理**：
- 自动扣减产品库存
- 生成应收账款
- 更新订单状态为"已出库"
- 更新出库单打印状态

### 场景2：部分出库

**业务场景**：订单数量较大，分批发货

**操作步骤**：
1. 选择销售订单
2. 修改出库数量为本次出库数量
3. 保存并审核出库单
4. 订单状态变为"部分出库"
5. 后续继续出库剩余数量

**系统处理**：
- 扣减本次出库数量的库存
- 生成应收账款（按本次出库金额）
- 更新订单已出库数量
- 可以继续出库剩余数量

### 场景3：替代品出库

**业务场景**：订单中的产品库存不足，使用功能相同或相似的产品替代

**操作步骤**：
1. 勾选"替代品出库"复选框（`chk替代品出库`）
2. 选择销售订单
3. 在明细中选择替代产品
4. 系统自动更新明细
5. 保存并审核出库单

**替代品出库说明**：
- 替代品必须在产品档案中设置关联关系
- 替代品库存充足
- 系统会记录原产品和替代品的对应关系
- 财务上按实际出库的产品核算成本

### 场景4：平台订单出库

**业务场景**：电商平台订单的出库发货

**操作步骤**：
1. 选择平台销售订单
2. 勾选"平台单"复选框（`chkIsFromPlatform`）
3. 填写物流单号（`txtTrackNo`）
4. 选择运输方式（`txtShippingWay`）
5. 保存并审核出库单
6. 在电商平台更新物流状态

**平台出库说明**：
- 必须填写物流单号
- 物流单号会同步到电商平台
- 需要在平台确认收货
- 系统会跟踪平台订单状态

### 场景5：定制订单出库

**业务场景**：定制产品生产完成后的出库

**操作步骤**：
1. 勾选"定制订单"复选框（`chkIsCustomizedOrder`）
2. 选择定制销售订单
3. 系统自动带出生产入库信息
4. 确认出库数量
5. 保存并审核出库单

**定制出库说明**：
- 定制产品必须有生产入库记录
- 定制成本自动计入出库成本
- 出库后生成应收账款
- 不能出库未生产完成的定制产品

### 场景6：生成凭证

**业务场景**：出库后自动生成财务凭证

**操作步骤**：
1. 勾选"生成凭证"复选框（`chkGenerateVouchers`）
2. 保存并审核出库单
3. 系统自动生成财务凭证
4. 在财务模块查看凭证

**生成凭证说明**：
- 凭证类型：销售出库
- 借方：主营业务成本、库存商品
- 贷方：主营业务收入、应交税费
- 自动关联出库单编号

## 关键字段说明

### 来源订单字段

| 字段 | 控件 | 业务意义 | 使用场景 |
|-----|------|---------|---------|
| 销售订单 | `txtSaleOrder` | 来源销售订单 | 从订单出库时选择 |
| 订单编号 | `lblOrder_ID` | 订单编号显示 | 系统自动显示 |

### 出库信息字段

| 字段 | 控件 | 业务意义 | 使用场景 |
|-----|------|---------|---------|
| 出库单号 | `txtSaleOutNo` | 出库单唯一标识 | 系统自动生成 |
| 出库日期 | `dtpOutDate` | 实际出库日期 | 默认当天，可修改 |
| 仓库 | `lblStore_ID` | 出库仓库 | 系统自动带出订单仓库 |

### 客户信息字段

| 字段 | 控件 | 业务意义 | 使用场景 |
|-----|------|---------|---------|
| 客户 | `cmbCustomerVendor_ID` | 收货客户 | 从订单带出，可修改 |
| 客户PO号 | `txtCustomerPONo` | 客户采购订单号 | 从订单带出 |
| 平台订单号 | `txtPlatformOrderNo` | 电商平台订单号 | 平台订单带出 |

### 交期信息字段

| 字段 | 控件 | 业务意义 | 使用场景 |
|-----|------|---------|---------|
| 交货日期 | `dtpDeliveryDate` | 实际交货日期 | 实际发货时填写 |
| 运输方式 | `txtShippingWay` | 物流运输方式 | 物流安排 |
| 送货地址 | `txtShippingAddress` | 送货地址 | 从订单带出，可修改 |

### 财务信息字段

| 字段 | 控件 | 业务意义 | 使用场景 |
|-----|------|---------|---------|
| 币别 | `cmbCurrency_ID` | 结算货币 | 从订单带出 |
| 汇率 | `txtExchangeRate` | 外币汇率 | 外贸订单带出 |
| 付款状态 | `cmbPayStatus` | 出库单付款状态 | 系统自动更新 |
| 退货状态 | `cmbRefundStatus` | 退货状态 | 如有退货会更新 |

### 特殊选项字段

| 字段 | 控件 | 业务意义 | 使用场景 |
|-----|------|---------|---------|
| 定制订单 | `chkIsCustomizedOrder` | 是否为定制产品出库 | 定制产品勾选 |
| 平台单 | `chkIsFromPlatform` | 是否为平台订单 | 平台订单勾选 |
| 替代品出库 | `chk替代品出库` | 是否使用替代品 | 产品库存不足时 |
| 生成凭证 | `chkGenerateVouchers` | 是否自动生成财务凭证 | 需要生成凭证时 |

### 物流信息字段

| 字段 | 控件 | 业务意义 | 使用场景 |
|-----|------|---------|---------|
| 物流单号 | `txtTrackNo` | 物流运输单号 | 平台订单必填 |
| 运费成本 | `txtFreightCost` | 物流运费成本 | 实际支付的运费 |

### 审批信息字段

| 字段 | 控件 | 业务意义 | 使用场景 |
|-----|------|---------|---------|
| 审批结果 | `chkApprovalResults` | 审批是否通过 | 审批人填写 |
| 审批意见 | `txtApprovalOpinions` | 审批意见说明 | 审批人填写 |

## 出库明细表格

### 出库数量

- **默认值**：订单剩余数量
- **可修改**：可以小于订单数量（部分出库）
- **限制**：不能超过订单剩余数量
- **库存检查**：不能超过可用库存

### 成本信息

- **单位成本**：系统自动计算，按先进先出（FIFO）或加权平均
- **总成本**：单位成本 × 出库数量
- **定制成本**：定制订单会额外计入定制成本

### 金额信息

- **单价**：从订单带出，一般不修改
- **金额**：单价 × 出库数量
- **折扣**：从订单带出
- **税额**：系统自动计算

## 状态流转

### 出库单状态

| 状态 | 说明 | 可执行操作 |
|-----|------|-----------|
| 新建 | 出库单刚创建，未审核 | 编辑、审核、删除 |
| 已审核 | 出库单已审核，库存已扣减 | 取消审核、打印、开票 |
| 已开票 | 已开具销售发票 | 查询、打印 |
| 已完成 | 出库单已全部收款 | 查询、打印 |
| 已取消 | 出库单已取消 | 查询（不可编辑） |

### 退货状态

| 状态 | 说明 |
|-----|------|
| 未退货 | 出库单未发生退货 |
| 部分退货 | 已部分退货 |
| 全部退货 | 已全部退货 |

## 常见业务问题

### Q1: 出库单审核后还能修改吗？

A: 已审核的出库单不能直接修改，需要先取消审核。取消审核后系统会恢复库存。

### Q2: 如何处理产品库存不足？

A: 有以下几种处理方式：
1. **替代品出库**：勾选"替代品出库"，选择库存充足的替代品
2. **部分出库**：先出库可用库存，剩余库存到货后继续出库
3. **调拨库存**：从其他仓库调拨产品到当前仓库

### Q3: 出库单与销售订单如何关联？

A: 在出库单中选择销售订单，系统会自动关联。出库数量会自动扣减订单的未出库数量。

### Q4: 平台出库有什么特殊要求？

A: 平台出库必须：
- 勾选"平台单"
- 填写物流单号
- 在电商平台更新物流状态
- 等待平台确认收货

### Q5: 如何查看某个出库单的详细信息？

A:
1. 打开出库单查询界面
2. 在"出库单号"中输入要查询的单号
3. 点击"查询"按钮
4. 双击查询结果打开详细界面

## 打印功能

### 打印出库单

1. 打开出库单
2. 点击工具栏"打印"按钮
3. 选择打印模板（出库单、送货单、装箱单）
4. 预览打印效果
5. 确认打印

### 打印物流标签

1. 选中的出库明细行
2. 点击"打印物流标签"按钮
3. 系统自动生成物流标签
4. 打印并粘贴到包裹

## 快捷键

| 快捷键 | 功能 |
|-------|------|
| F1 | 显示帮助 |
| F5 | 刷新数据 |
| Ctrl+N | 新建出库单 |
| Ctrl+S | 保存出库单 |
| Ctrl+F | 打开查询界面 |
| Ctrl+E | 编辑出库单 |
| Ctrl+D | 删除出库单 |
| Alt+A | 审核出库单 |
| Alt+C | 取消审核 |
| Ctrl+P | 打印出库单 |

## 注意事项

1. **库存控制**：出库数量不能超过可用库存，否则系统会提示
2. **订单关联**：建议从订单生成出库单，可以保持数据一致性
3. **成本核算**：出库成本按成本核算方法（FIFO、加权平均等）自动计算
4. **财务凭证**：勾选"生成凭证"后，系统会自动生成财务凭证
5. **数据保存**：离开窗体前请确保已保存数据，否则修改会丢失

## 错误处理

### 常见错误及解决方案

| 错误提示 | 原因 | 解决方案 |
|---------|------|---------|
| 库存不足 | 出库数量超过可用库存 | 减少出库数量或使用替代品 |
| 订单已全部出库 | 订单已完成出库 | 不能再从该订单出库 |
| 产品已停产 | 产品已标记为停产 | 选择其他产品 |
| 未选择仓库 | 未指定出库仓库 | 在订单中选择仓库 |

## 相关帮助

- [销售订单](./UCSaleOrder.md)
- [销售退货单](./UCSaleReturn.md)
- [库存管理](./InventoryManagement.md)
- [财务应收](./ARReceivable.md)
- [销售管理模块](../Modules/SalesManagement.md)
