# 销售管理模块

## 模块概述

销售管理模块是企业的核心业务模块，负责处理从客户询价、报价、销售订单、出库发货到收款的全流程业务。该模块支持多种业务场景，包括普通销售、平台订单、定制订单、外贸订单等。

## 核心业务流程

### 1. 标准销售流程

```
客户询价 → 销售报价 → 销售订单 → 销售出库 → 应收账款
```

**流程说明**：
1. 客户询价：记录客户需求，进行初步报价
2. 销售报价：确认价格、交期、付款条件后生成正式报价单
3. 销售订单：客户确认报价后转为销售订单，锁定库存和生产计划
4. 销售出库：产品生产完成后，根据订单生成出库单并发货
5. 应收账款：发货后生成应收账款，跟踪收款进度

### 2. 平台订单流程

```
平台下单 → 销售订单（平台订单）→ 销售出库 → 平台发货 → 平台对账
```

**特殊处理**：
- 需要填写平台订单号（`txtPlatformOrderNo`）
- 勾选"平台单"（`chk平台单`）
- 跟踪物流单号（`txtTrackNo`）
- 需要等待平台确认后才确认收入

### 3. 定制订单流程

```
客户需求 → 销售订单（定制）→ 生产工单 → 生产入库 → 销售出库
```

**特殊处理**：
- 勾选"定制订单"（`chkIsCustomizedOrder`）
- 在订单明细中填写定制成本（`CustomizedCost`）
- 定制成本会影响产品成本计算
- 可能需要单独计算工时和材料成本

### 4. 外贸订单流程

```
外贸询价 → 销售订单（外币）→ 生产/采购 → 出库报关 → 收汇核销
```

**特殊处理**：
- 选择外币币别（`cmbCurrency_ID`）
- 设置汇率（`txtExchangeRate`）
- 外币金额自动计算（`txtForeignTotalAmount`、`txtForeignFreightIncome`、`txtForeignDeposit`）
- 需要记录报关信息

### 5. 销售退货流程

```
客户退货申请 → 销售退货单 → 退回入库 → 退款处理 → 账务调整
```

## 关键业务规则

### 库存管理

1. **订单库存占用**：销售订单创建后，系统自动占用产品库存
2. **部分出库**：支持订单分多次出库，系统跟踪每次出库数量
3. **替代品出库**：当原产品库存不足时，可以使用替代品出库（勾选`chk替代品出库`）
4. **库存回滚**：订单取消时，自动释放占用的库存

### 价格管理

1. **客户价目表**：系统自动应用客户的专属价格
2. **折扣规则**：支持按客户等级、产品类别设置折扣
3. **历史价格**：系统记录产品历史成交价，方便参考
4. **价格审批**：特价或大额折扣需要审批

### 信用控制

1. **信用额度**：订单金额不能超过客户信用额度
2. **逾期账款**：有逾期未付款的客户限制新增订单
3. **预付款要求**：信用较差的客户要求预付款

### 交期管理

1. **预交期**（`dtpPreDeliveryDate`）：承诺给客户的交货日期
2. **生产排产**：根据预交期自动排产
3. **交期预警**：临近交期自动提醒
4. **延迟处理**：延期交货需要填写原因

## 常见业务场景

### 场景1：现货销售

**适用情况**：客户需求的产品有库存

**操作步骤**：
1. 创建销售订单
2. 选择客户和产品
3. 系统自动检查库存
4. 直接生成出库单发货
5. 生成应收账款

### 场景2：预订单销售

**适用情况**：客户需要的产品需要生产

**操作步骤**：
1. 创建销售订单
2. 填写预交期
3. 系统生成生产工单
4. 生产完成后入库
5. 生成出库单发货

### 场景3：部分出库

**适用情况**：订单数量较大，分批发货

**操作步骤**：
1. 创建销售订单，录入总数量
2. 第一次出库：填写实际出库数量
3. 系统自动更新订单状态
4. 第二次出库：录入剩余数量
5. 重复直到全部出库完成

### 场景4：订单变更

**适用情况**：客户要求修改订单内容

**操作步骤**：
1. 查询原订单
2. 点击"变更"按钮
3. 修改订单明细
4. 系统记录变更日志
5. 需要重新审批

### 场景5：订单取消

**适用情况**：客户取消订单

**操作步骤**：
1. 查询要取消的订单
2. 点击"取消"按钮
3. 选择取消原因
4. 系统自动释放库存占用
5. 通知相关部门

## 特殊业务处理

### 1. 跨仓调拨

当产品在A仓库，但需要从B仓库发货时：
1. 创建跨仓调拨单
2. 产品从A仓调到B仓
3. 从B仓出库发货

### 2. 样品赠送

**处理方式**：
1. 创建销售订单，金额设为0
2. 选择"样品"产品类别
3. 在备注中注明"赠送样品"
4. 出库后不计入销售收入

### 3. 套装产品

**处理方式**：
1. 在产品档案中定义套装包含的子产品
2. 销售时选择套装产品
3. 系统自动按套装清单占用子产品库存
4. 出库时按套装清单出库

### 4. 促销活动

**处理方式**：
1. 设置促销规则（买赠、满减等）
2. 订单自动匹配促销规则
3. 系统自动计算优惠金额
4. 在订单中记录促销信息

## 数据统计与报表

### 关键指标

- **订单完成率**：已完成订单数/总订单数
- **订单准时率**：准时交货订单数/总订单数
- **平均订单金额**：总销售金额/订单数
- **客户复购率**：复购客户数/总客户数

### 常用报表

1. **销售日报**：每日销售汇总
2. **客户销售分析**：按客户统计销售额
3. **产品销售分析**：按产品统计销量和金额
4. **业务员业绩**：按业务员统计销售额和佣金
5. **应收账款账龄**：按账龄统计应收账款

## 系统集成

### 与库存系统集成
- 自动扣减库存
- 库存预警提示
- 可用库存查询

### 与财务系统集成
- 自动生成应收账款
- 收款自动核销
- 生成财务凭证

### 与生产系统集成
- 自动生成生产工单
- 生产进度反馈
- 完工入库自动关联

## 常见问题

### Q1: 订单可以修改吗？

A: 已审核的订单不能直接修改，需要先取消审核才能修改。建议使用订单变更功能，这样可以保留变更历史。

### Q2: 如何处理订单数量与出库数量不一致？

A: 系统支持部分出库。如果实际出库数量少于订单数量，订单状态会变为"部分出库"，可以后续继续出库。

### Q3: 平台订单如何处理？

A: 勾选"平台单"选项，并填写平台订单号。系统会自动跟踪平台订单状态。

### Q4: 如何查询某个客户的订单历史？

A: 在订单查询界面，选择客户编号，即可查询该客户的所有订单。

### Q5: 外币订单如何处理汇率变动？

A: 系统使用订单创建时的汇率计算本币金额。如果后续汇率变动，不影响已创建的订单。新订单使用最新汇率。

## 相关模块

- [库存管理](../Modules/InventoryManagement.md)
- [财务应收](../Modules/AccountsReceivable.md)
- [生产管理](../Modules/ProductionManagement.md)
- [采购管理](../Modules/PurchaseManagement.md)

## 快捷键

- **F1**: 显示帮助
- **F5**: 刷新数据
- **Ctrl+S**: 保存当前单据
- **Ctrl+N**: 新建单据
- **Ctrl+F**: 打开查询界面
- **Alt+O**: 打开出库单
- **Alt+R**: 打开退货单
