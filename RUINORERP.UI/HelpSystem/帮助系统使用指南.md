# RUINORERP 帮助系统使用指南

## 1. 系统架构概述

### 1.1 核心组件
- **HelpManager** - 帮助管理器（单例），协调整个帮助系统
- **HelpProvider** - 帮助内容提供者接口，支持本地文件和远程服务
- **HelpContext** - 帮助上下文，描述帮助请求的元数据
- **HelpExtensions** - 扩展方法，提供便捷的API
- **HelpPanel** - 帮助显示面板
- **HelpTooltip** - 智能提示气泡

### 1.2 四级帮助体系
1. **模块级别** - 整个业务模块的帮助
2. **窗体级别** - 单个窗体的帮助
3. **控件级别** - 特定控件的帮助
4. **字段级别** - 数据字段的帮助

## 2. 已集成的基类

### 2.1 BaseEdit
```csharp
public partial class BaseEdit : KryptonForm
{
    /// <summary>
    /// 是否启用智能帮助
    /// </summary>
    public bool EnableSmartHelp { get; set; } = true;

    /// <summary>
    /// 窗体帮助键
    /// </summary>
    public string FormHelpKey { get; set; }

    /// <summary>
    /// 初始化帮助系统（在构造函数中自动调用）
    /// </summary>
    protected virtual void InitializeHelpSystem() { }
}
```

### 2.2 BaseEditGeneric<T>
```csharp
public partial class BaseEditGeneric<T> : KryptonForm where T : class
{
    /// <summary>
    /// 是否启用智能帮助
    /// </summary>
    public bool EnableSmartHelp { get; set; } = true;

    /// <summary>
    /// 窗体帮助键
    /// </summary>
    public string FormHelpKey { get; set; }

    /// <summary>
    /// 初始化帮助系统（在构造函数中自动调用）
    /// </summary>
    protected virtual void InitializeHelpSystem() { }
}
```

## 3. 在具体窗体中使用

### 3.1 基本使用
继承自已集成的基类（BaseEdit或BaseEditGeneric<T>），帮助系统会自动初始化。

```csharp
public partial class CustomerEdit : BaseEdit
{
    public CustomerEdit()
    {
        InitializeComponent();

        // 设置窗体帮助键（可选，默认使用窗体类型名称）
        FormHelpKey = "Customer";
    }
}
```

### 3.2 为控件设置帮助键
```csharp
public partial class CustomerEdit : BaseEdit
{
    public CustomerEdit()
    {
        InitializeComponent();

        // 为特定控件设置帮助键
        txtCustomerName.SetHelpKey("Customer.Name");
        txtPhone.SetHelpKey("Customer.Phone");
        txtEmail.SetHelpKey("Customer.Email");
    }
}
```

### 3.3 手动触发帮助
```csharp
// 显示窗体帮助
this.ShowFormHelp();

// 显示控件帮助
txtCustomerName.ShowHelp();

// 显示字段帮助
this.ShowFieldHelp(typeof(Customer), "Name");
```

## 4. 帮助内容结构

### 4.1 目录结构
```
HelpContent/
├── modules/              # 模块级别帮助
│   ├── Sales/
│   │   ├── index.md
│   │   └── overview.md
│   └── Purchase/
├── forms/                # 窗体级别帮助
│   ├── CustomerEdit.md
│   ├── SalesOrderEdit.md
│   └── PurchaseOrderEdit.md
├── controls/             # 控件级别帮助
│   ├── CustomerEdit/
│   │   ├── Name.md
│   │   └── Phone.md
│   └── SalesOrderEdit/
└── fields/               # 字段级别帮助
    ├── Customer.Name.md
    ├── Customer.Phone.md
    └── SalesOrder.OrderNo.md
```

### 4.2 帮助文件格式（Markdown）
```markdown
---
title: 客户编辑
level: form
formType: CustomerEdit
---

# 客户编辑窗体

## 功能说明
此窗体用于编辑客户基本信息，包括客户名称、联系方式、地址等。

## 操作步骤
1. 填写客户名称（必填）
2. 填写联系电话（必填）
3. 填写邮箱地址（可选）
4. 填写详细地址（可选）
5. 点击"保存"按钮

## 注意事项
- 客户名称不能重复
- 联系电话格式必须正确
```

## 5. CHM帮助文件生成

### 5.1 工具推荐
- **HTML Help Workshop** - Microsoft官方工具
- **Help & Manual** - 商业工具，功能强大
- **CHM Builder** - 开源工具

### 5.2 使用HTML Help Workshop生成CHM

#### 步骤1：安装HTML Help Workshop
下载并安装 Microsoft HTML Help Workshop

#### 步骤2：创建项目
1. 打开 HTML Help Workshop
2. File > New > Project
3. 指定项目文件路径（例如：RUINORERP.hhp）

#### 步骤3：添加主题文件
1. Project > Add/Remove Topic Files
2. 选择 HelpContent 目录下的所有 HTML 文件
3. 先将 Markdown 转换为 HTML（使用 Pandoc 或 MarkdownToHtml）

#### 步骤4：创建目录（TOC）
1. Contents 标签 > New Heading
2. 添加模块、窗体、控件等分类
3. 将主题文件拖放到对应节点下

#### 步骤5：创建索引
1. Index 标签 > New Keyword
2. 为重要主题添加关键词
3. 关联到对应的主题文件

#### 步骤6：编译
1. File > Compile
2. 选择项目文件
3. 生成 CHM 文件

### 5.3 Markdown转HTML脚本
```batch
REM 批量将Markdown转换为HTML
FOR /R "HelpContent" %%f IN (*.md) DO (
  pandoc "%%f" -o "%%~dpnf.html" --standalone
)
```

## 6. 配置示例

### 6.1 模块级帮助配置
文件：`HelpContent/modules/Sales/index.md`
```markdown
---
title: 销售管理模块
level: module
moduleName: Sales
---

# 销售管理模块

## 模块概述
销售管理模块负责处理公司销售业务，包括客户管理、销售订单、发货、收款等。

## 主要功能
- 客户信息管理
- 销售订单处理
- 出库发货管理
- 应收账款管理
- 销售报表分析
```

### 6.2 窗体级帮助配置
文件：`HelpContent/forms/SalesOrderEdit.md`
```markdown
---
title: 销售订单编辑
level: form
formType: SalesOrderEdit
---

# 销售订单编辑窗体

## 功能说明
用于创建和编辑销售订单，支持选择客户、添加商品明细、计算金额等功能。
```

### 6.3 控件级帮助配置
文件：`HelpContent/controls/SalesOrderEdit/CustomerName.md`
```markdown
---
title: 客户名称控件
level: control
formType: SalesOrderEdit
controlName: txtCustomerName
---

# 客户名称控件

## 控件说明
用于选择销售订单对应的客户。

## 使用方法
1. 点击右侧的"..."按钮
2. 在弹出的客户列表中选择客户
3. 双击或点击"确定"按钮

## 注意事项
- 只能选择状态为"正常"的客户
- 客户名称选择后不可修改
```

## 7. 高级功能

### 7.1 动态帮助加载
```csharp
// 重新加载帮助索引
HelpManager.Instance.ReloadHelpIndex();

// 清除帮助缓存
HelpManager.Instance.ClearCache();

// 获取帮助统计信息
int helpCount = HelpManager.Instance.GetHelpCount();
```

### 7.2 自定义帮助提供者
```csharp
// 实现自定义帮助提供者
public class DatabaseHelpProvider : IHelpProvider
{
    public string GetHelpContent(HelpContext context)
    {
        // 从数据库获取帮助内容
    }

    public List<HelpSearchResult> Search(string keyword, HelpContext context)
    {
        // 在数据库中搜索帮助
    }
}

// 注册自定义提供者
HelpManager.Instance.HelpProvider = new DatabaseHelpProvider();
```

### 7.3 智能提示配置
```csharp
// 配置智能提示参数
HelpManager.Instance.EnableSmartTooltip = true;
HelpManager.Instance.TooltipDelay = 500;  // 毫秒
```

## 8. 调试与日志

### 8.1 启用调试输出
```csharp
// 帮助系统会将调试信息输出到Debug窗口
System.Diagnostics.Debug.WriteLine("帮助系统调试信息");
```

### 8.2 常见问题排查
1. **帮助内容不显示** - 检查帮助文件路径和格式
2. **智能提示不工作** - 检查 EnableSmartTooltip 配置
3. **F1键无响应** - 确认 EnableF1Help() 已调用
4. **搜索结果不准确** - 检查帮助文件的关键词设置

## 9. 最佳实践

1. **保持帮助文件结构清晰** - 按模块、窗体、控件组织
2. **使用简洁明了的语言** - 避免技术术语，面向最终用户
3. **定期更新帮助内容** - 与产品功能同步更新
4. **添加截图和示例** - 提升用户体验
5. **测试帮助功能** - 在发布前验证所有帮助链接可用

## 10. 后续计划

- [ ] 支持多媒体内容（视频、音频）
- [ ] 支持多语言帮助
- [ ] 集成在线帮助服务
- [ ] 添加帮助使用统计
- [ ] 支持用户反馈和评分
