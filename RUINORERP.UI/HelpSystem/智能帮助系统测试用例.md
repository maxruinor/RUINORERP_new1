# 智能帮助系统测试用例

## 测试概述
本文档提供了智能帮助系统的完整测试用例，覆盖所有4种窗体类型和核心功能。

---

## 测试环境

### 系统环境
- 操作系统: Windows 10/11
- .NET Framework: 4.7.2+
- 数据库: SQL Server 2016+

### 测试数据
- 菜单配置: tb_MenuInfo 表
- 帮助文件: HelpContent/ 目录
- 测试用户: 普通用户 + 超级用户

---

## 测试用例分类

### 1. 单据编辑窗体测试
### 2. 单据查询窗体测试
### 3. 基础信息编辑窗体测试
### 4. 基础信息列表窗体测试
### 5. 智能匹配功能测试
### 6. 性能测试
### 7. 异常处理测试

---

## 1. 单据编辑窗体测试

### TC-BE-01: 销售订单编辑窗体 - F1帮助

**测试步骤**:
1. 登录系统
2. 导航到: 销售订单管理 → 销售订单
3. 打开销售订单编辑窗体
4. 选中客户下拉框 (cmbCustomerVendor_ID)
5. 按F1键

**预期结果**:
- 显示帮助面板
- 帮助内容: `HelpContent/Fields/tb_SaleOrder/CustomerVendor_ID.md`
- 帮助标题: "客户 - 帮助"
- 显示帮助内容正确

**实际结果**: ____________

**测试状态**: [ ] 通过 [ ] 失败

**备注**: ____________

---

### TC-BE-02: 销售订单编辑窗体 - 智能提示

**测试步骤**:
1. 登录系统
2. 导航到: 销售订单管理 → 销售订单
3. 打开销售订单编辑窗体
4. 将鼠标悬停在总金额文本框 (txtTotalCost) 上
5. 等待500ms

**预期结果**:
- 显示帮助提示气泡
- 帮助内容: `HelpContent/Fields/tb_SaleOrder/TotalCost.md` 的前200字
- 提示气泡位置正确
- 鼠标离开后气泡消失

**实际结果**: ____________

**测试状态**: [ ] 通过 [ ] 失败

**备注**: ____________

---

### TC-BE-03: 销售订单编辑窗体 - 窗体级帮助

**测试步骤**:
1. 登录系统
2. 导航到: 销售订单管理 → 销售订单
3. 打开销售订单编辑窗体
4. 点击帮助按钮 (如果有)
5. 或按 F1 键（当没有选中控件时）

**预期结果**:
- 显示窗体级帮助
- 帮助内容: `HelpContent/Forms/UCSaleOrder.md`
- 帮助标题: "销售订单编辑 - 帮助"

**实际结果**: ____________

**测试状态**: [ ] 通过 [ ] 失败

**备注**: ____________

---

### TC-BE-04: 销售订单编辑窗体 - 禁用帮助系统

**测试步骤**:
1. 修改 `UCSaleOrder.cs` 构造函数
2. 添加: `this.EnableSmartHelp = false;`
3. 重新编译运行
4. 打开销售订单编辑窗体
5. 按F1键

**预期结果**:
- 不显示智能帮助
- 不显示帮助提示气泡
- F1键无响应（或显示旧帮助系统）

**实际结果**: ____________

**测试状态**: [ ] 通过 [ ] 失败

**备注**: ____________

---

### TC-BE-05: 采购订单编辑窗体 - 智能匹配

**测试步骤**:
1. 登录系统
2. 导航到: 采购订单管理 → 采购订单
3. 打开采购订单编辑窗体
4. 选中供应商下拉框 (cmbCustomerVendor_ID)
5. 按F1键

**预期结果**:
- 智能识别实体类型: `tb_PurchaseOrder`
- 智能识别字段名: `CustomerVendor_ID`
- 生成帮助键: `Fields.tb_PurchaseOrder.CustomerVendor_ID`
- 显示帮助内容: `HelpContent/Fields/tb_PurchaseOrder/CustomerVendor_ID.md`

**实际结果**: ____________

**测试状态**: [ ] 通过 [ ] 失败

**备注**: ____________

---

## 2. 单据查询窗体测试

### TC-BQ-01: 销售订单查询窗体 - F1帮助

**测试步骤**:
1. 登录系统
2. 导航到: 销售订单管理 → 订单查询
3. 打开销售订单查询窗体
4. 选中客户名称查询框
5. 按F1键

**预期结果**:
- 显示帮助面板
- 智能识别实体类型: `tb_SaleOrder`
- 智能识别字段名: `CustomerVendor_ID`
- 显示帮助内容: `HelpContent/Fields/tb_SaleOrder/CustomerVendor_ID.md`

**实际结果**: ____________

**测试状态**: [ ] 通过 [ ] 失败

**备注**: ____________

---

### TC-BQ-02: 销售订单查询窗体 - 智能提示

**测试步骤**:
1. 登录系统
2. 导航到: 销售订单管理 → 订单查询
3. 打开销售订单查询窗体
4. 将鼠标悬停在订单日期查询框上
5. 等待500ms

**预期结果**:
- 显示帮助提示气泡
- 帮助内容: `HelpContent/Fields/tb_SaleOrder/OrderDate.md` 的前200字
- 提示气泡位置正确

**实际结果**: ____________

**测试状态**: [ ] 通过 [ ] 失败

**备注**: ____________

---

## 3. 基础信息编辑窗体测试

### TC-BI-01: 客户编辑窗体 - F1帮助

**测试步骤**:
1. 登录系统
2. 导航到: 基础资料 → 客户 → 客户编辑
3. 打开客户编辑窗体
4. 选中客户名称文本框
5. 按F1键

**预期结果**:
- 显示帮助面板
- 智能识别实体类型: `tb_Customer`
- 智能识别字段名: `CustomerName`
- 显示帮助内容: `HelpContent/Fields/tb_Customer/CustomerName.md`

**实际结果**: ____________

**测试状态**: [ ] 通过 [ ] 失败

**备注**: ____________

---

### TC-BI-02: 客户编辑窗体 - 自定义帮助键

**测试步骤**:
1. 修改 `UCCustomerEdit.cs` 构造函数
2. 添加: `this.FormHelpKey = "客户管理";`
3. 重新编译运行
4. 打开客户编辑窗体
5. 按F1键（窗体级）

**预期结果**:
- 显示窗体级帮助
- 帮助键: `Forms.客户管理`
- 帮助内容: `HelpContent/Forms/客户管理.md`

**实际结果**: ____________

**测试状态**: [ ] 通过 [ ] 失败

**备注**: ____________

---

## 4. 基础信息列表窗体测试

### TC-BL-01: 客户列表窗体 - F1帮助

**测试步骤**:
1. 登录系统
2. 导航到: 基础资料 → 客户 → 客户列表
3. 打开客户列表窗体
4. 选中客户名称列
5. 按F1键

**预期结果**:
- 显示帮助面板
- 智能识别实体类型: `tb_Customer`
- 智能识别字段名: `CustomerName`
- 显示帮助内容: `HelpContent/Fields/tb_Customer/CustomerName.md`

**实际结果**: ____________

**测试状态**: [ ] 通过 [ ] 失败

**备注**: ____________

---

### TC-BL-02: 客户列表窗体 - 网格帮助

**测试步骤**:
1. 登录系统
2. 导航到: 基础资料 → 客户 → 客户列表
3. 打开客户列表窗体
4. 将鼠标悬停在客户列表网格上
5. 等待500ms

**预期结果**:
- 显示帮助提示气泡
- 帮助内容: `HelpContent/Forms/UCCustomerList.md` 的前200字
- 提示气泡位置正确

**实际结果**: ____________

**测试状态**: [ ] 通过 [ ] 失败

**备注**: ____________

---

## 5. 智能匹配功能测试

### TC-SM-01: 泛型类型解析

**测试步骤**:
1. 打开销售订单编辑窗体
2. 使用调试器检查窗体类型
3. 验证智能解析器解析的实体类型

**预期结果**:
- 窗体类型: `UCSaleOrder`
- 基类: `BaseBillEditGeneric<tb_SaleOrder, tb_SaleOrderDetail>`
- 解析结果: 实体类型 = `tb_SaleOrder`

**实际结果**: ____________

**测试状态**: [ ] 通过 [ ] 失败

**备注**: ____________

---

### TC-SM-02: 控件名提取

**测试步骤**:
1. 打开销售订单编辑窗体
2. 选中客户下拉框 (cmbCustomerVendor_ID)
3. 按F1键
4. 使用调试器检查解析的字段名

**预期结果**:
- 控件名: `cmbCustomerVendor_ID`
- 提取结果: 字段名 = `CustomerVendor_ID`
- 帮助键: `Fields.tb_SaleOrder.CustomerVendor_ID`

**实际结果**: ____________

**测试状态**: [ ] 通过 [ ] 失败

**备注**: ____________

---

### TC-SM-03: 字段存在性验证

**测试步骤**:
1. 打开销售订单编辑窗体
2. 选中客户下拉框 (cmbCustomerVendor_ID)
3. 按F1键
4. 使用调试器检查字段验证结果

**预期结果**:
- 字段名: `CustomerVendor_ID`
- 实体类型: `tb_SaleOrder`
- 验证结果: 字段存在 ✓
- 可以显示帮助

**实际结果**: ____________

**测试状态**: [ ] 通过 [ ] 失败

**备注**: ____________

---

### TC-SM-04: 多级回退机制

**测试步骤**:
1. 删除 `HelpContent/Fields/tb_SaleOrder/CustomerVendor_ID.md`
2. 打开销售订单编辑窗体
3. 选中客户下拉框 (cmbCustomerVendor_ID)
4. 按F1键
5. 观察帮助显示

**预期结果**:
- 尝试帮助键: `Fields.tb_SaleOrder.CustomerVendor_ID` → 不存在
- 回退到: `Controls.UCSaleOrder.cmbCustomerVendor_ID`
- 显示控件级帮助或提示

**实际结果**: ____________

**测试状态**: [ ] 通过 [ ] 失败

**备注**: ____________

---

### TC-SM-05: 菜单信息辅助解析

**测试步骤**:
1. 打开销售订单编辑窗体
2. 使用调试器检查 `CurMenuInfo` 属性
3. 验证菜单信息是否正确传递
4. 检查智能解析器是否使用菜单信息

**预期结果**:
- `CurMenuInfo` 不为 null
- `CurMenuInfo.EntityName` = `tb_SaleOrder`
- `CurMenuInfo.CaptionCN` = `销售订单`
- 智能解析器使用了菜单信息

**实际结果**: ____________

**测试状态**: [ ] 通过 [ ] 失败

**备注**: ____________

---

## 6. 性能测试

### TC-PE-01: 帮助键生成性能

**测试步骤**:
1. 打开销售订单编辑窗体
2. 选中客户下拉框 (cmbCustomerVendor_ID)
3. 按F1键
4. 使用性能分析器测量帮助键生成时间

**预期结果**:
- 实体类型解析: < 0.5ms
- 字段名提取: < 0.1ms
- 字段验证: < 0.2ms
- 帮助键生成: < 0.1ms
- **总计**: < 1.3ms

**实际结果**: ____________

**测试状态**: [ ] 通过 [ ] 失败

**备注**: ____________

---

### TC-PE-02: 帮助内容加载性能

**测试步骤**:
1. 打开销售订单编辑窗体
2. 选中客户下拉框 (cmbCustomerVendor_ID)
3. 按F1键
4. 使用性能分析器测量帮助内容加载时间

**预期结果**:
- 首次加载: < 10ms
- 缓存加载: < 0.5ms
- **总计**: < 10.5ms

**实际结果**: ____________

**测试状态**: [ ] 通过 [ ] 失败

**备注**: ____________

---

### TC-PE-03: 批量测试

**测试步骤**:
1. 打开10个不同的窗体
2. 在每个窗体中测试F1帮助
3. 测量总体耗时

**预期结果**:
- 每个窗体平均耗时: < 10ms
- 总耗时: < 100ms
- 无内存泄漏

**实际结果**: ____________

**测试状态**: [ ] 通过 [ ] 失败

**备注**: ____________

---

## 7. 异常处理测试

### TC-EH-01: 帮助文件不存在

**测试步骤**:
1. 删除所有帮助文件
2. 打开销售订单编辑窗体
3. 按F1键

**预期结果**:
- 显示提示: "未找到帮助内容"
- 不抛出异常
- 不影响窗体正常使用

**实际结果**: ____________

**测试状态**: [ ] 通过 [ ] 失败

**备注**: ____________

---

### TC-EH-02: CurMenuInfo为null

**测试步骤**:
1. 修改MenuHelper，不传递CurMenuInfo
2. 重新编译运行
3. 打开销售订单编辑窗体
4. 按F1键

**预期结果**:
- 智能解析器正常工作
- 使用泛型类型解析实体类型
- 正常显示帮助

**实际结果**: ____________

**测试状态**: [ ] 通过 [ ] 失败

**备注**: ____________

---

### TC-EH-03: 控件名为空

**测试步骤**:
1. 创建一个没有Name属性的控件
2. 添加到窗体
3. 按F1键

**预期结果**:
- 不抛出异常
- 显示提示或忽略
- 不影响其他控件的帮助功能

**实际结果**: ____________

**测试状态**: [ ] 通过 [ ] 失败

**备注**: ____________

---

### TC-EH-04: 反射异常处理

**测试步骤**:
1. 修改MenuHelper，模拟反射异常
2. 重新编译运行
3. 打开销售订单编辑窗体
4. 检查调试输出

**预期结果**:
- 异常被捕获
- 调试输出: "设置CurMenuInfo失败: ..."
- 窗体正常打开
- 帮助功能仍可使用

**实际结果**: ____________

**测试状态**: [ ] 通过 [ ] 失败

**备注**: ____________

---

## 测试统计

### 测试用例总数
- 单据编辑窗体测试: 5
- 单据查询窗体测试: 2
- 基础信息编辑窗体测试: 2
- 基础信息列表窗体测试: 2
- 智能匹配功能测试: 5
- 性能测试: 3
- 异常处理测试: 4
- **总计**: 23

### 通过率统计
- 通过: ___
- 失败: ___
- 未测试: ___
- **通过率**: ___%

---

## 测试报告模板

### 测试执行摘要

**测试日期**: ____________
**测试人员**: ____________
**测试环境**: ____________

**测试结果**:
- 通过: ___ / 23
- 失败: ___ / 23
- 未测试: ___ / 23
- **通过率**: ___%

**关键发现**:
1. ____________
2. ____________
3. ____________

**建议**:
1. ____________
2. ____________
3. ____________

---

## 相关文档

1. **基类帮助系统集成完成报告.md** - 第1步完成报告
2. **MenuHelper更新完成报告.md** - 第2步完成报告
3. **智能帮助系统架构说明.md** - 完整技术架构
4. **智能帮助系统快速参考.md** - 快速上手指南

---

**状态**: 📝 待测试
**文档版本**: v1.0
**最后更新**: 2025-01-15
