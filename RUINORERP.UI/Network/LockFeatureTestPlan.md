# 心跳失败检测与客户端锁定功能测试方案

## 概述
本文档提供了心跳失败检测与客户端锁定功能的详细测试方案，确保该功能能够正常触发、正确锁定用户操作并在登录后恢复正常。

## 测试环境
- 开发环境：Visual Studio 2022
- 运行环境：Windows 10/11
- 网络条件：可控制的网络连接（用于模拟网络断开）

## 测试功能

### 1. 心跳失败检测与锁定触发测试

#### 测试步骤
1. 启动应用程序并成功登录
2. 验证状态栏显示"状态: 正常"且颜色为绿色
3. 模拟网络断开（可通过以下方式之一）：
   - 禁用网络连接
   - 断开服务器连接
   - 阻止应用程序的网络访问
4. 等待心跳检测失败达到阈值（默认设置的5次）

#### 预期结果
- 心跳失败次数达到阈值后，系统应自动触发锁定
- 状态栏显示应更新为"状态: 锁定"且颜色为红色
- 应弹出锁定提示对话框，显示锁定原因
- 日志中应记录心跳失败次数和锁定触发信息

### 2. 锁定状态下的用户操作限制测试

#### 测试步骤
1. 触发系统锁定（按照上述步骤）
2. 尝试执行以下操作：
   - 点击菜单项
   - 拖动或关闭标签页
   - 点击工具栏按钮
   - 操作状态栏
   - 尝试打开新的功能模块

#### 预期结果
- 所有UI组件应被禁用，无法进行任何操作
- 菜单项点击无反应
- 工具栏按钮禁用
- 标签页无法拖动或关闭
- 只有重新登录选项可用

### 3. 登录后状态恢复测试

#### 测试步骤
1. 触发系统锁定
2. 恢复网络连接
3. 点击锁定对话框中的"确定"按钮或关闭对话框后点击重新登录
4. 输入有效的登录凭据并成功登录

#### 预期结果
- 登录成功后，状态栏应显示"状态: 正常"且颜色为绿色
- 所有UI组件应重新启用，用户可以正常操作
- 锁定状态标志应重置为false
- 日志中应记录锁定解除和UI组件重新启用的信息

## 测试异常场景

### 1. 锁定过程中的异常处理测试

#### 测试步骤
1. 模拟网络断开，触发锁定过程
2. 在锁定过程中人为中断（如强制关闭对话框）

#### 预期结果
- 系统应继续执行锁定流程，不受中断影响
- 异常应被捕获并记录，不会导致应用程序崩溃

### 2. 多次快速触发锁定测试

#### 测试步骤
1. 触发系统锁定
2. 在锁定状态下，尝试再次触发锁定

#### 预期结果
- 系统应检测到已经处于锁定状态，忽略重复的锁定请求
- 日志中应记录重复锁定请求的信息

### 3. 登录过程中的异常处理测试

#### 测试步骤
1. 触发系统锁定
2. 在重新登录过程中人为中断或遇到网络问题

#### 预期结果
- 系统应正确处理异常，不会导致应用程序崩溃
- 异常信息应被记录到日志中
- 用户应能够重新尝试登录

## 日志检查点
在测试过程中，应检查以下日志信息是否正确记录：

1. 心跳失败检测日志
2. 锁定触发日志
3. UI组件禁用日志
4. 锁定提示显示日志
5. 登录成功后的状态重置日志
6. UI组件重新启用日志

## 注意事项
1. 确保测试环境中记录足够详细的日志
2. 测试完成后恢复所有网络连接和系统设置
3. 测试过程中注意记录异常情况和实际行为
4. 测试完成后提供测试报告，包括通过/失败情况和发现的问题

---

测试完成后，请将测试结果记录在此文档中，以便后续参考和问题追踪。