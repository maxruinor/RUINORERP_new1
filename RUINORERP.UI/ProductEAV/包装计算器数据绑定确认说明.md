# 包装计算器数据绑定确认说明

## 当前实现状态

### 1. 外箱数据源 (tb_CartoonBox) ✅
**实现方式**：
- 下拉框：`cmbBoxSelect` 绑定到 `tb_CartoonBox` 表
- 自动填充：选择预设外箱时自动填充到 `numBoxLength`、`numBoxWidth`、`numBoxHeight`
- 承重关联：自动将外箱最大承重(kg)转换为克并设置到 `numMaxWeight`

**代码示例**：
```csharp
private void cmbBoxSelect_SelectedIndexChanged(object sender, EventArgs e)
{
    if (cmbBoxSelect.SelectedItem != null)
    {
        var selectedBox = cmbBoxSelect.SelectedItem as tb_CartoonBox;
        if (selectedBox != null)
        {
            // 自动填充外箱尺寸信息
            numBoxLength.Value = selectedBox.Length;
            numBoxWidth.Value = selectedBox.Width;
            numBoxHeight.Value = selectedBox.Height;
            
            // 更新最大重量为外箱承重(kg转g)
            numMaxWeight.Value = (decimal)(selectedBox.MaxLoad * 1000);
        }
    }
}
```

### 2. 成品数据源 (tb_Packing) ✅
**实现方式**：
- 下拉框：`cmbProductSelect` 绑定到 `tb_Packing` 表
- 自动填充：选择包装规格时自动填充到 `numProductLength`、`numProductWidth`、`numProductHeight`
- 重量使用：采用包装毛重(`GrossWeight`)而非产品净重

**代码示例**：
```csharp
private void cmbProductSelect_SelectedIndexChanged(object sender, EventArgs e)
{
    if (cmbProductSelect.SelectedItem != null && !chkMixedPack.Checked)
    {
        var selectedPacking = cmbProductSelect.SelectedItem as tb_Packing;
        if (selectedPacking != null)
        {
            // 自动填充包装信息（使用Packing表数据）
            numProductLength.Value = selectedPacking.Length;
            numProductWidth.Value = selectedPacking.Width;
            numProductHeight.Value = selectedPacking.Height;
        }
    }
}
```

### 3. 灵活计算机制 ✅
**支持的操作**：
- ✅ 选择预设外箱规格 → 自动填充尺寸 → 参考计算
- ✅ 选择预设包装规格 → 自动填充尺寸 → 参考计算  
- ✅ 手动修改外箱尺寸 → 直接计算
- ✅ 手动修改产品尺寸 → 直接计算
- ✅ 混合两种方式使用

**计算逻辑**：
```csharp
// 使用用户输入的外箱尺寸创建临时箱规进行计算
var customBox = new tb_CartoonBox
{
    CartonName = "自定义箱规",
    Length = numBoxLength.Value,
    Width = numBoxWidth.Value,
    Height = numBoxHeight.Value,
    MaxLoad = (double)(maxWeight / 1000) // kg
};
```

## 数据流向图

```
tb_CartoonBox (外箱表)
    ↓ 绑定到 cmbBoxSelect
    ↓ 选择时触发 SelectedIndexChanged
    ↓ 自动填充到数值控件
    numBoxLength ← selectedBox.Length
    numBoxWidth ← selectedBox.Width  
    numBoxHeight ← selectedBox.Height
    numMaxWeight ← selectedBox.MaxLoad * 1000

tb_Packing (包装规格表)
    ↓ 绑定到 cmbProductSelect
    ↓ 选择时触发 SelectedIndexChanged
    ↓ 自动填充到数值控件
    numProductLength ← selectedPacking.Length
    numProductWidth ← selectedPacking.Width
    numProductHeight ← selectedPacking.Height
    Weight ← selectedPacking.GrossWeight (计算时使用)
```

## 用户操作场景验证

### 场景1：完全使用预设规格
1. 从 `cmbBoxSelect` 选择预设外箱规格
2. 从 `cmbProductSelect` 选择包装规格  
3. 点击"开始计算"
4. ✅ 系统使用选择的规格进行计算

### 场景2：预设+手动混合
1. 从 `cmbBoxSelect` 选择外箱规格（自动填充尺寸）
2. 手动调整 `numBoxLength` 数值
3. 从 `cmbProductSelect` 选择包装规格
4. 点击"开始计算"  
5. ✅ 系统使用修改后的外箱尺寸+选择的产品规格计算

### 场景3：完全手动输入
1. 直接在 `numBoxLength`、`numBoxWidth`、`numBoxHeight` 输入自定义尺寸
2. 直接在产品尺寸控件中输入自定义数值
3. 点击"开始计算"
4. ✅ 系统使用手动输入的尺寸进行计算

## 确认事项

请您确认以下几点是否符合您的预期：

1. **外箱数据绑定**：`cmbBoxSelect` 是否正确绑定了 `tb_CartoonBox` 数据？
2. **成品数据绑定**：`cmbProductSelect` 是否正确绑定了 `tb_Packing` 数据？  
3. **自动填充功能**：选择规格后是否能正确自动填充到对应数值控件？
4. **手动修改支持**：是否支持在自动填充基础上手动修改数值？
5. **计算灵活性**：是否支持预设规格、手动输入、混合使用等各种场景？

如有需要调整的地方，请告诉我具体的要求，我可以进一步优化实现。