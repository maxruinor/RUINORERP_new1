# 多属性产品导入配置示例

基于CSV数据的配置示例，用于导入多属性产品。

## 配置结构

```xml
<ImportConfiguration>
  <MappingName>硅胶产品多属性导入配置</MappingName>
  <EntityType>tb_Prod</EntityType>
  
  <!-- 多属性导入配置 -->
  <MultiAttributeImportConfig>
    <IsEnabled>true</IsEnabled>
    
    <!-- 产品分组字段：同一末位流水编号的产品属于同一个基础产品 -->
    <GroupByField>末位流水编号</GroupByField>
    
    <!-- 基础产品字段映射 -->
    <BaseProductFields>
      <ProductNoColumn>雷阳货号</ProductNoColumn>
      <CNNameColumn>供货商来货品名</CNNameColumn>
      <SpecificationsColumn>雷阳品名规格</SpecificationsColumn>
      <UnitColumn>单位（含采购运费）</UnitColumn>
      
      <!-- 品名清理规则：移除属性信息 -->
      <!-- 例如："8连长方肥皂225手工皂 颜色: 紫色" -> "8连长方肥皂225手工皂" -->
      <CNNameCleanupPattern>[\s]+\w+:\s*[\u4e00-\u9fa5\w\s\-\(\)]+$</CNNameCleanupPattern>
    </BaseProductFields>
    
    <!-- 属性提取规则 -->
    <AttributeExtractionRules>
      <!-- 颜色属性：从供货商来货品名列中提取 -->
      <AttributeExtractionRule>
        <AttributeName>颜色</AttributeName>
        <ExcelColumn></ExcelColumn>
        <Pattern>颜色:\s*([\u4e00-\u9fa5\w\s\-\(\)]+)</Pattern>
        <GroupIndex>1</GroupIndex>
        <IsRequired>true</IsRequired>
      </AttributeExtractionRule>
      
      <!-- 规格属性：从供货商来货品名列中提取 -->
      <AttributeExtractionRule>
        <AttributeName>规格</AttributeName>
        <ExcelColumn></ExcelColumn>
        <Pattern>规格:\s*([\u4e00-\u9fa5\w\s\-\(\)\*\u00d7]+)</Pattern>
        <GroupIndex>1</GroupIndex>
        <IsRequired>false</IsRequired>
      </AttributeExtractionRule>
    </AttributeExtractionRules>
    
    <!-- SKU明细字段映射 -->
    <SKUDetailFields>
      <SKUDetailFieldMapping>
        <SystemField>SKUCode</SystemField>
        <ExcelColumn>雷阳货号</ExcelColumn>
        <DataType>string</DataType>
      </SKUDetailFieldMapping>
      <SKUDetailFieldMapping>
        <SystemField>PurchasePrice</SystemField>
        <ExcelColumn>单价（含采购运费）</ExcelColumn>
        <DataType>decimal</DataType>
      </SKUDetailFieldMapping>
      <SKUDetailFieldMapping>
        <SystemField>CostPrice</SystemField>
        <ExcelColumn>成本价（含打包费用及发货运费等）</ExcelColumn>
        <DataType>decimal</DataType>
      </SKUDetailFieldMapping>
      <SKUDetailFieldMapping>
        <SystemField>Unit_ID</SystemField>
        <ExcelColumn>单位（含采购运费）</ExcelColumn>
        <DataType>long</DataType>
      </SKUDetailFieldMapping>
    </SKUDetailFields>
    
    <!-- 属性值标准化映射 -->
    <AttributeValueMappings>
      <!-- 颜色值标准化 -->
      <AttributeValueMapping>
        <AttributeName>颜色</AttributeName>
        <OriginalValue>玫瑰色</OriginalValue>
        <StandardizedValue>红色</StandardizedValue>
      </AttributeValueMapping>
      <AttributeValueMapping>
        <AttributeName>颜色</AttributeName>
        <OriginalValue>粉红色</OriginalValue>
        <StandardizedValue>粉色</StandardizedValue>
      </AttributeValueMapping>
      <AttributeValueMapping>
        <AttributeName>颜色</AttributeName>
        <OriginalValue>玫红色</OriginalValue>
        <StandardizedValue>粉色</StandardizedValue>
      </AttributeValueMapping>
      <AttributeValueMapping>
        <AttributeName>颜色</AttributeName>
        <OriginalValue>天蓝色</OriginalValue>
        <StandardizedValue>蓝色</StandardizedValue>
      </AttributeValueMapping>
    </AttributeValueMappings>
  </MultiAttributeImportConfig>
  
  <!-- 列映射（用于验证和补充字段） -->
  <ColumnMappings>
    <ColumnMapping>
      <ExcelColumn>供应商</ExcelColumn>
      <SystemField>
        <Key>VendorID</Key>
        <Value>供应商</Value>
      </SystemField>
      <DataSourceType>ForeignKey</DataSourceType>
      <ForeignConfig>
        <ForeignKeyTable>
          <Key>tb_CustomerVendor</Key>
          <Value>供应商表</Value>
        </ForeignKeyTable>
        <ForeignKeyField>
          <Key>VendorName</Key>
          <Value>供应商名称</Value>
        </ForeignKeyField>
        <ForeignKeySourceColumn>
          <Key>供应商</Key>
          <Value>供应商</Value>
        </ForeignKeySourceColumn>
      </ForeignConfig>
    </ColumnMapping>
    <ColumnMapping>
      <ExcelColumn>雷阳货号</ExcelColumn>
      <SystemField>
        <Key>ProductNo</Key>
        <Value>品号</Value>
      </SystemField>
      <IsUniqueValue>true</IsUniqueValue>
      <DataSourceType>Excel</DataSourceType>
    </ColumnMapping>
  </ColumnMappings>
</ImportConfiguration>
```

## 配置说明

### 1. 产品分组字段 (GroupByField)
- 用于识别同一基础产品的不同SKU
- CSV数据示例：`末位流水编号 = 0009` 对应多个SKU（不同颜色、规格）
- 相同分组值的行会被合并为一个基础产品

### 2. 基础产品字段映射 (BaseProductFields)
- **ProductNoColumn**: 品号列（雷阳货号）
- **CNNameColumn**: 品名列（供货商来货品名）
- **SpecificationsColumn**: 规格列（雷阳品名规格）
- **UnitColumn**: 单位列
- **CNNameCleanupPattern**: 品名清理正则表达式，用于移除属性信息

### 3. 属性提取规则 (AttributeExtractionRules)
- **AttributeName**: 属性名称（系统中使用的名称）
- **ExcelColumn**: 属性值所在的Excel列（空表示从品名列提取）
- **Pattern**: 正则表达式，用于提取属性值
- **GroupIndex**: 正则分组索引（通常为1）
- **IsRequired**: 是否必填属性

示例正则表达式：
- `颜色:\s*([\u4e00-\u9fa5\w\s\-\(\)]+)` - 提取"颜色: xxx"中的xxx
- `规格:\s*([\u4e00-\u9fa5\w\s\-\(\)\*\u00d7]+)` - 提取"规格: xxx"中的xxx

### 4. SKU明细字段映射 (SKUDetailFields)
- **SystemField**: 系统字段名（tb_ProdDetail表字段）
- **ExcelColumn**: Excel列名
- **DataType**: 数据类型（string/decimal/int/long/bool/datetime）

### 5. 属性值标准化映射 (AttributeValueMappings)
- 用于统一属性值的表达方式
- 例如："玫瑰色"、"粉红色"、"玫红色" -> "粉色"

## 导入流程

1. **分组**: 按照分组字段（末位流水编号）对Excel数据进行分组
2. **提取基础信息**: 从每组的第一行提取基础产品信息（品号、品名、规格等）
3. **提取属性**: 从所有行的供货商来货品名列中提取属性信息（颜色、规格）
4. **标准化属性值**: 根据标准化映射统一属性值
5. **创建基础产品**: 保存到tb_Prod表，PropertyType设置为多属性
6. **创建属性类型和值**: 保存到tb_ProdPropertyType和tb_ProdPropertyValue表
7. **创建SKU明细**: 保存到tb_ProdDetail表，包含属性组合

## 数据示例

### 输入数据（CSV）
| 末位流水编号 | 供货商来货品名 | 雷阳货号 | 单价 | 成本价 |
|------------|----------------|----------|------|--------|
| 0009 | 37格蜂窝冰格绿色 | BG010009 | 1.95 | 2.18 |
| 0009 | 37格蜂窝冰格粉色-3PCs | T3-BG010009-FEN | 5.85 | 6.55 |
| 0009 | 37格蜂窝冰格蓝色-3PCs | T3-BG010009-LAN | 5.85 | 6.55 |

### 输出结果

**tb_Prod（基础产品）**
- ProdBaseID: 1001
- ProductNo: BG010009
- CNName: 37格蜂窝冰格（清理后）
- PropertyType: 2 (多属性)

**tb_ProdPropertyType（属性类型）**
- PropertyTypeID: 1, ProdBaseID: 1001, PropertyName: 颜色

**tb_ProdPropertyValue（属性值）**
- PropertyValueID: 1, PropertyTypeID: 1, PropertyValueName: 绿色
- PropertyValueID: 2, PropertyTypeID: 1, PropertyValueName: 粉色
- PropertyValueID: 3, PropertyTypeID: 1, PropertyValueName: 蓝色

**tb_ProdDetail（SKU明细）**
- ProdDetailID: 1, ProdBaseID: 1001, SKUCode: BG010009, PurchasePrice: 1.95, AttributeCombination: "颜色:绿色:1"
- ProdDetailID: 2, ProdBaseID: 1001, SKUCode: T3-BG010009-FEN, PurchasePrice: 5.85, AttributeCombination: "颜色:粉色:2"
- ProdDetailID: 3, ProdBaseID: 1001, SKUCode: T3-BG010009-LAN, PurchasePrice: 5.85, AttributeCombination: "颜色:蓝色:3"
